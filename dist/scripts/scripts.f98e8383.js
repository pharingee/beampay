"use strict";angular.module("app",["ngCookies","ngResource","ui.router","ngSanitize","ngTouch","ngAnimate","ui.bootstrap","angular-loading-bar","app.config","app.utils","app.general","app.auth","app.transaction","app.settings","app.airtime","app.television","app.utility","app.internet","app.school"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){c.hashPrefix("!");var d="apps/transaction/views/";a.state("app",{url:"/",templateUrl:d+"app.html",data:{pageTitle:"Welcome"}}),b.otherwise("/home")}]).run(["$rootScope","$anchorScroll","Auth","$state",function(a,b,c,d){a.$on("$stateChangeSuccess",function(e,f){angular.isDefined(f.data.pageTitle)&&(angular.isDefined(f.data.pageSubtitle)?a.pageTitle=f.data.pageSubtitle+" :: "+f.data.pageTitle+" | BeamPay":a.pageTitle=f.data.pageTitle+" | BeamPay");for(var g=["signin","signup","activate","confirmEmail","forgot","signupComplete","landing","hiw","about"],h=!0,i=0;i<g.length;i++)f.name===g[i]&&(h=!1);h&&!c.isLoggedIn()&&d.transitionTo("signin",{next:d.current.name}),b()}),(new WOW).init()}]),angular.module("app.config",[]).constant("name","staging").constant("API_SERVER","https://api-dev.beampay.co/api/v1/").constant("FACEBOOK_CLIENT_ID",0x58d55a1a5968a).constant("STRIPE_KEY","pk_test_zYX7SkWrbMZCszrPcoDPu4iI"),angular.module("app").controller("HeaderCtrl",["$scope","$state","Auth","Persist",function(a,b,c,d){c.isLoggedIn()?a.loggedin=!0:a.loggedin=!1,a.logoutInProgress=!1,a.logout=function(){a.logoutInProgress=!0,c.signout().then(function(){a.logoutInProgress=!1,a.loggedin=!1,b.transitionTo("landing")})},a.signup=function(){b.transitionTo("signup")},a.signin=function(){b.transitionTo("signin")},a.dashboard=function(){b.transitionTo("app")},a.currentUser=d.getUser()}]),angular.module("app.utils",[]).service("Persist",["$window","$cookieStore",function(a,b){var c="userid",d="token",e="email",f="firstName",g="lastName",h="pricing",i=function(a,e){b.put(c,a),b.put(d,e)},j=function(a,c){b.put(f,a),b.put(g,c)},k=function(){b.remove(c),b.remove(d),b.remove(e),b.remove(f),b.remove(g)},l=function(){return{userid:b.get(c),token:b.get(d),firstName:b.get(f),lastName:b.get(g)}},m=function(a){b.put(e,a)},n=function(){return b.get(e)},o=function(a){b.put(h,JSON.stringify(a))},p=function(){return JSON.parse(b.get(h))};return{saveUser:function(a,b){return i(a,b)},saveUserName:function(a,b){return j(a,b)},getUser:function(){return l()},deleteUser:function(){return k()},saveEmail:function(a){return m(a)},getEmail:function(){return n()},savePricing:function(a){return o(a)},getPricing:function(){return p()}}}]),angular.module("app.general",[]).config(["$stateProvider",function(a){var b="apps/general/views/";a.state("landing",{url:"/home",templateUrl:b+"landing/landing.html",data:{pageTitle:"Beam - Care for loved ones in Ghana quickly and affordably"}}).state("hiw",{url:"/how",templateUrl:b+"hiw/hiw.html",data:{pageTitle:"How it works"}}).state("about",{url:"/about",templateUrl:b+"about/about.html",data:{pageTitle:"About BeamPay"}})}]),angular.module("app.general").controller("NotifyCtrl",["$scope","$modal",function(a,b){a.open=function(){b.open({templateUrl:"apps/general/views/landing/modals/_email.html",controller:"ModalCtrl"})}}]),angular.module("app.general").controller("ModalCtrl",["$scope","$modalInstance","Modal",function(a,b,c){a.ok=function(){a.fromName&&a.fromEmail&&a.toName&&a.toEmail&&(a.loading=!0,c.sendEmail(a.fromName,a.fromEmail,a.toName,a.toEmail).then(function(){a.loading=!1,b.close()},function(b){a.loading=!1,a.err=b}))},a.cancel=function(){b.dismiss()}}]),angular.module("app.general").service("Modal",["$http","$q",function(a,b){var c=function(c,d,e,f){var g=b.defer();return a.post("/email",{fromname:c,replyto:d,toname:e,to:f}).success(function(){g.resolve()}).error(function(a){g.reject(a)}),g.promise};return{sendEmail:function(a,b,d,e){return c(a,b,d,e)}}}]),angular.module("app.auth",["satellizer"]).config(["$stateProvider","$httpProvider","$authProvider","API_SERVER","FACEBOOK_CLIENT_ID",function(a,b,c,d,e){var f="/auth/",g="apps/auth/views/";a.state("signup",{url:f+"signup",templateUrl:g+"signup.html",data:{pageTitle:"Signup"}}).state("signupComplete",{url:f+"signup/complete",templateUrl:g+"signupComplete.html",data:{pageTitle:"Signup Complete"}}).state("signin",{url:f+"signin/?next",templateUrl:g+"signin.html",data:{pageTitle:"Signin"}}).state("activate",{url:f+"activate/:key/",templateUrl:g+"activate.html",data:{pageTitle:"Activate"}}).state("settings",{url:f+"settings",templateUrl:g+"settings.html",data:{pageTitle:"Settings"}}).state("settings.email",{url:f+"settings/email",templateUrl:g+"changeEmail.html",data:{pageTitle:"Email Settings"}}).state("settings.password",{url:f+"settings/password",templateUrl:g+"password.html",data:{pageTitle:"Password Settings"}}).state("forgot",{url:f+"forgot",templateUrl:g+"forgot.html",data:{pageTitle:"Forgot Password"}}).state("resetPassword",{url:f+"forgot/:key",templateUrl:g+"resetPassword.html",data:{pageTitle:"Reset Password"}}),b.interceptors.push("AuthInterceptor"),c.baseUrl=d,c.facebook({clientId:e,url:"account/signin/facebook/"})}]),angular.module("app.auth").controller("SignupCtrl",["$scope","$state","$auth","Auth","Error",function(a,b,c,d,e){a.signup={},a.signup.submit=function(){a.signup.errors=[];var c=a.signup.email,f=a.signup.pass1,g=a.signup.pass2,h=a.signup.privacy;return c&&f&&g&&h?f!==g?void a.signup.errors.push("Passwords don't match"):void d.signup(c,f,g,h).then(function(){b.transitionTo("signupComplete")},function(b){a.signup.errors=e.signup(b)}):void a.signup.errors.push("All fields required")},a.signup.fb=function(){c.authenticate("facebook",{acceptedPrivacyPolicy:!0}).then(function(a){d.persist(a.data.id,a.data.token),b.transitionTo("onboard.name"),a.data.newUser?b.transitionTo("app"):b.transitionTo("onboard.name")},function(b){a.signup.errors=e.signInFb(b.data)})}}]),angular.module("app.auth").controller("SignInCtrl",["$scope","$state","$stateParams","$window","$auth","Auth","Error",function(a,b,c,d,e,f,g){a.signIn={},a.signIn.submit=function(){a.signIn.errors=[];var d=a.signIn.email,e=a.signIn.pass;return d&&e?void f.signIn(d,e).then(function(a){if(a){var d=c.next;d?b.transitionTo(d):b.transitionTo("app")}else b.transitionTo("onboard.name")},function(b){a.signIn.errors=g.signIn(b)}):void a.signIn.errors.push("All fields required")},a.signIn.fb=function(){e.authenticate("facebook",{acceptedPrivacyPolicy:!0}).then(function(a){f.persist(a.data.id,a.data.token),a.data.newUser?b.transitionTo("app"):b.transitionTo("onboard.name")},function(b){a.signIn.errors=g.signInFb(b.data)})},a.forgot=function(){b.transitionTo("forgot")}}]),angular.module("app.auth").controller("SignoutCtrl",["$scope","$state","Auth",function(a,b,c){a.signout=function(){c.signout().then(function(){b.transitionTo("landing")},function(){b.transitionTo("landing")})}}]),angular.module("app.auth").controller("ActivateCtrl",["$scope","$state","$stateParams","Auth","Error",function(a,b,c,d,e){a.activate={};var f=c.key;f?d.activate(f).then(function(){b.transitionTo("onboard.name")},function(b){a.activate.errors=e.activate(b)}):b.transitionTo("landing")}]),angular.module("app.auth").controller("ActivateResendCtrl",["$scope","Auth","Error",function(a,b,c){a.activateResend={},a.activateResend.submit=function(){b.activateResend().then(function(){a.activateResend.success=!0},function(b){a.activateResend.errors=c.activateResend(b)})}}]),angular.module("app.auth").controller("ChangeEmailCtrl",["$scope","Settings","Error",function(a,b,c){a.changeEmail={},a.changeEmail.submit=function(){a.changeEmail.errors=[];var d=a.changeEmail.email;return d?void b.changeEmail(d).then(function(){a.changeEmail.success=!0},function(b){a.changeEmail.errors=c.changeEmail(b)}):void a.changeEmail.errors.push("Email required")}}]),angular.module("app.auth").controller("ConfirmEmailCtrl",["$scope","$state","$stateParams","Settings","Error",function(a,b,c,d,e){a.confirmEmail={};var f=c.key;f?d.confirmEmail(f).then(function(){a.confirmEmail.success=!0},function(b){a.confirmEmail.errors=e.confirmEmail(b)}):b.transitionTo("landing")}]),angular.module("app.auth").controller("PasswordCtrl",["$scope","Settings","Error",function(a,b,c){a.password={},b.isPassword().then(function(b){b?a.password.passwordExists=!0:a.password.passwordNoExists=!0},function(a){c.isPassword(a)}),a.changePassword={},a.changePassword.submit=function(){a.changePassword.errors=[];var d=a.changePassword.oldPass,e=a.changePassword.pass1,f=a.changePassword.pass2;return d&&e&&f?e!==f?void a.changePassword.errors.push("New passwords don't match"):void b.changePassword(d,e,f).then(function(){a.changePassword.success=!0},function(b){a.changePassword.errors=c.changePassword(b)}):void a.changePassword.errors.push("All fields required")},a.setPassword={},a.setPassword.submit=function(){a.setPassword.errors=[];var d=a.setPassword.pass1,e=a.setPassword.pass2;return d&&e?d!==e?void a.setPassword.errors.push("Passwords don't match"):void b.setPassword(d,e).then(function(){a.setPassword.success=!0},function(b){a.setPassword.errors=c.setPassword(b)}):void a.setPassword.errors.push("All fields required")}}]),angular.module("app.auth").controller("ForgotCtrl",["$scope","Settings","Error",function(a,b,c){a.forgot={},a.forgot.submit=function(){a.forgot.errors=[];var d=a.forgot.email;return d?void b.requestResetPassword(d).then(function(){a.forgot.email=d,a.forgot.success=!0},function(b){a.forgot.errors=c.forgot(b)}):void a.forgot.errors.push("Email required")}}]),angular.module("app.auth").controller("ResetPasswordCtrl",["$scope","$state","$stateParams","Settings","Error",function(a,b,c,d,e){var f=c.key;f?(a.resetPassword={},d.showResetPassword(f).then(function(){a.resetPassword.can=!0},function(){a.resetPassword.cannot=!0}),a.resetPassword.submit=function(){a.resetPassword.errors=[];var b=a.resetPassword.pass1,c=a.resetPassword.pass2;return b&&c?b!==c?void a.resetPassword.errors.push("Passwords don't match"):void d.resetPassword(f,b,c).then(function(){a.resetPassword.success=!0},function(b){a.resetPassword.errors=e.resetPassword(b)}):void a.resetPassword.errors.push("All fields required")}):b.transitionTo("landing")}]),angular.module("app.auth").service("Auth",["$cookieStore","$http","$q","Persist","API_SERVER",function(a,b,c,d,e){e+="account/";var f=function(a,b){d.saveUser(a,b)},g=function(a,b){d.saveUserName(a,b)},h=function(a,f,g,h){var i=e+"signup/",j=c.defer();return d.deleteUser(),b.post(i,{email:a,password1:f,password2:g,acceptedPrivacyPolicy:h}).success(function(){d.saveEmail(a),j.resolve()}).error(function(a){j.reject(a)}),j.promise},i=function(a,h){var i=e+"signin/",j=c.defer();return d.deleteUser(),b.post(i,{email:a,password:h}).success(function(a){f(a.id,a.token),a.complete&&g(a.firstName,a.lastName),j.resolve(a.complete)}).error(function(a){j.reject(a)}),j.promise},j=function(){var a=e+"signout/",f=c.defer();return b.post(a).success(function(){d.deleteUser(),f.resolve()}).error(function(a){f.reject(a)}),f.promise},k=function(a){var d=e+"activate/"+a+"/",g=c.defer();return b.get(d).success(function(a){console.log(a),f(a.id,a.token),g.resolve()}).error(function(a){g.reject(a)}),g.promise},l=function(){var a=e+"activate/resend/",f=c.defer();return b.post(a,{email:d.getEmail()}).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise},m=function(){return d.getUser().userid?!0:!1};return{persist:function(a,b){return f(a,b)},saveName:function(a,b){return g(a,b)},signup:function(a,b,c,d){return h(a,b,c,d)},signIn:function(a,b){return i(a,b)},signout:function(){return j()},activate:function(a){return k(a)},activateResend:function(a){return l(a)},isLoggedIn:function(){return m()}}}]),angular.module("app.auth").service("Settings",["$http","$q","Persist","API_SERVER",function(a,b,c,d){d+="account/";var e=function(c){var e=d+"email/",f=b.defer();return a.post(e,{email:c}).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise},f=function(c){var e=d+"confirm-email/"+c+"/",f=b.defer();return a.get(e).success(function(){f.resolve()}).error(function(a){console.log(a),f.reject(a)}),f.promise},g=function(){var c=d+"password/set/",e=b.defer();return a.get(c).success(function(a){e.resolve(a.passwordSet)}).error(function(a){e.reject(a)}),e.promise},h=function(e,f,g){var h=d+"password/",i=b.defer();return a.post(h,{oldPassword:e,password1:f,password2:g}).success(function(a){var b=c.getUser().userid;c.saveUser(b,a.token),i.resolve()}).error(function(a){i.reject(a)}),i.promise},i=function(c,e){var f=d+"password/set/",g=b.defer();return a.post(f,{password1:c,password2:e}).success(function(){g.resolve()}).error(function(a){g.reject(a)}),g.promise},j=function(c){var e=d+"password/reset/",f=b.defer();return a.post(e,{email:c}).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise},k=function(c){var e=d+"password/reset/confirm/"+c+"/",f=b.defer();return a.get(e).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise},l=function(c,e,f){var g=d+"password/reset/confirm/"+c+"/",h=b.defer();return a.post(g,{password1:e,password2:f}).success(function(){h.resolve()}).error(function(a){h.reject(a)}),h.promise};return{changeEmail:function(a){return e(a)},confirmEmail:function(a){return f(a)},changePassword:function(a,b,c){return h(a,b,c)},isPassword:function(a){return g(a)},setPassword:function(a,b){return i(a,b)},requestResetPassword:function(a){return j(a)},showResetPassword:function(a){return k(a)},resetPassword:function(a,b,c){return l(a,b,c)}}}]),angular.module("app.auth").service("Error",function(){var a=function(a){var b=[];return a?a.password1&&"1"===a.password1[0]?b.push("Weak Pass"):a.email&&"4"===a.email[0]?b.push("Email in user"):a.email&&"5"===a.email[0]?b.push("Email not activated"):a.nonFieldErrors&&"2"===a.nonFieldErrors[0]?b.push("Pass match failed"):a.acceptedPrivacyPolicy&&"3"===a.acceptedPrivacyPolicy[0]?b.push("Privacy false"):b.push("Unknown Error"):b.push("Unknown Error"),b},b=function(a){var b=[];return a.nonFieldErrors&&("11"===a.nonFieldErrors[0]?b.push("Account disabled"):"13"===a.nonFieldErrors[0]?b.push("Invalid credentials"):"0"===a.nonFieldErrors[0]?b.push("All fields required"):"14"===a.nonFieldErrors[0]?b.push("Admin accounts not allowed"):"12"===a.nonFieldErrors[0]&&b.push("Account not activated yet.")),b},c=function(){var a=[];return a.push("Facebook Authentication Failed"),a},d=function(a){var b=[];return a?"6"===a.detail?b.push("Invalid Activation Key"):"7"===a.detail&&b.push("Key Expired"):b.push("Unknown Error"),b},e=function(a){var b=[];return a?"9"===a.detail?b.push("Email not registered"):"10"===a.detail?b.push("Account activated"):"11"===a.detail&&b.push("Account disabled"):b.push("Unknown Error"),b},f=function(a){var b=[];return a?"0"===a.detail?b.push("Invalid Parameters"):"4"===a.detail?b.push("This email is already in use"):"15"===a.detail&&b.push("Email has not been changed"):b.push("Unknown Error"),b},g=function(a){var b=[];return a?"0"===a.detail&&b.push("Invalid Parameters"):b.push("Unknown Error"),b},h=function(){var a=[];return a.push("Unknown Error"),a},i=function(a){var b=[];return a?a.oldPassword&&"16"===a.oldPassword[0]?b.push("Old Password is incorrect"):a.password1&&"1"===a.password1[0]?b.push("Weak pass"):a.nonFieldErrors&&"2"===a.nonFieldErrors[0]?b.push("Passwords don't match"):"20"===a.detail&&b.push("Passwords not set"):b.push("Unknown Error"),b},j=function(a){var b=[];return"0"===a.detail?b.push("Invalid Parameters"):a.password1&&"1"===a.password1[0]?b.push("Weak pass"):a.nonFieldErrors&&"2"===a.nonFieldErrors[0]?b.push("Passwords don't match"):"21"===a.detail&&b.push("Passwords already set"),b},k=function(a){var b=[];return a?"9"===a.detail?b.push("Email unknown"):"11"===a.detail?b.push("User Account disabled"):"12"===a.detail&&b.push("User Account not activated yet"):b.push("Unknown Error"),b},l=function(a,b){var c=[];return 451==b?c.push("Your country is not supported. We'll let you know when we support it"):0==a.detail?c.push("Some of the information you provided is incorrect. Please check and try again."):1==a.detail?c.push("The international exchange rate has changed. Please choose your service again."):2==a.detail?c.push("Your profile is incomplete please update your details in your settings"):c.push("Unknown error"),c},m=function(a){var b=[];return 0==a.detail?b.push("Some of the information you provided is incorrect. Please check and try again."):2==a.detail&&b.push("You have entered an invalid referral code. Please try again"),b};return{signup:function(b){return a(b)},signIn:function(a){return b(a)},signInFb:function(a){return c(a)},activate:function(a){return d(a)},activateResend:function(a){return e(a)},changeEmail:function(a){return f(a)},confirmEmail:function(a){return g(a)},isPassword:function(a){return h(a)},changePassword:function(a){return i(a)},setPassword:function(a){return j(a)},forgot:function(a){return k(a)},transaction:function(a,b){return l(a)},setReferral:function(a){return m(a)}}}),angular.module("app.auth").service("AuthInterceptor",["$q","$location","Persist","API_SERVER",function(a,b,c,d){var e=function(a){var b=new RegExp("^"+d);if(a.url.match(b)){a.headers=a.headers||{};var e=c.getUser();e&&e.token&&(a.headers.Authorization="Token "+e.token)}return a},f=function(d){return 401===d.status&&(c.deleteUser(),b.path(b.path())),a.reject(d)};return{request:function(a){return e(a)},responseError:function(a){return f(a)}}}]),angular.module("app.settings",[]).config(["$stateProvider",function(a){var b="apps/settings/views/";a.state("onboard",{url:"/settings/onboard","abstract":"true",template:"<ui-view/>"}).state("onboard.name",{url:"/name",templateUrl:b+"onboardName.html",data:{pageTitle:"Onboarding - Name"}}).state("onboard.address",{url:"/address",templateUrl:b+"onboardAddress.html",data:{pageTitle:"Onboarding - Address"}})}]),angular.module("app.settings").controller("OnboardNameCtrl",["$scope","$state","Onboard","Error",function(a,b,c,d){a.settings={},a.settings.submit=function(){a.settings.errors=[];var e=a.settings.firstName,f=a.settings.lastName;if(!e||!f)return void a.settings.errors.push("We need you to provide your full name.");var g=function(){c.saveName(e,f).then(function(){b.transitionTo("onboard.address")},function(){a.settings.errors.push("Some of the information you provided is invalid. Please check and try again.")})};a.settings.referralCode?c.setReferral(a.settings.referralCode).then(function(){g()},function(b){b.details&&1==b.details?g():a.settings.errors=d.setReferral(b)}):g()}}]),angular.module("app.settings").controller("OnboardAddressCtrl",["$scope","$state","Onboard","Persist",function(a,b,c,d){a.settings={},a.settings.country="US",a.settings.firstName=d.getUser().firstName,a.settings.submit=function(){return a.settings.errors=[],a.settings.dateOfBirth=a.settings.date.year+"-"+a.settings.date.month+"-"+a.settings.date.day,a.settings.dateOfBirth&&a.settings.country&&a.settings.phoneNumber?void c.saveAddress(a.settings).then(function(){b.transitionTo("app")},function(){a.settings.errors.push("This page has errors")}):void a.settings.errors.push("We need you to fill all the fields.")}}]),angular.module("app.settings").service("Onboard",["$http","$q","API_SERVER","Persist",function(a,b,c,d){var e=function(e,f){var g=c+"account/profile/",h=b.defer();return a.put(g,{firstName:e,lastName:f}).success(function(){d.saveUserName(e,f),h.resolve()}).error(function(a){h.reject(a)}),h.promise},f=function(d){var e=c+"account/profile/",f=b.defer();return a.put(e,{profile:d}).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise},g=function(d){var e=c+"referral/add/",f=b.defer();return a.post(e,{code:d}).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise};return{saveName:function(a,b){return e(a,b)},saveAddress:function(a){return f(a)},setReferral:function(a){return g(a)}}}]),angular.module("app.transaction",[]).config(function(){}),angular.module("app.transaction").controller("HomeCtrl",["$scope","Persist",function(a,b){a.currentUser=b.getUser(),console.log(b.getUser())}]),angular.module("app.transaction").service("Transaction",["$http","$q","API_SERVER","Persist",function(a,b,c,d){var e=function(d,e){var f=c+d,g=b.defer();return a.post(f,e).success(function(a){g.resolve(a)}).error(function(a){g.reject(a)}),g.promise},f=function(){var e=c+"pricing/",f=b.defer();return a.get(e).success(function(a){d.savePricing(a),f.resolve(a)}).error(function(a){f.reject(a)}),f.promise},g=function(){var d=c+"referral/",e=b.defer();return a.get(d).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},h=function(a){var b=d.getPricing();return a.exchangeRateId=b.exchangeRateId,a.serviceFeeId=b.serviceFeeId,e("transaction/add/airtime/",a)},i=function(a){var b=d.getPricing();return a.exchangeRateId=b.exchangeRateId,a.serviceFeeId=b.serviceFeeId,console.log(a),e("transaction/add/bill/",a)},j=function(a){return e("transaction/add/valet/",a)},k=function(a){return e("transaction/add/gift/",a)},l=function(a){return e("transaction/add/school/",a)},m=function(a){return console.log(a),e("payment/stripe/",a)};return{addAirtime:function(a){return h(a)},addBill:function(a){return i(a)},addValet:function(a){return j(a)},addGift:function(a){return k(a)},addSchool:function(a){return l(a)},getPricing:function(){return f()},getReferral:function(){return g()},savePayment:function(a){return m(a)}}}]),angular.module("app.television",[]).config(["$stateProvider",function(a){var b="apps/television/views/";a.state("app.television",{url:"^/television",templateUrl:b+"layouts/television.html"}).state("app.television.choose",{url:"/choose",templateUrl:b+"choose.html",data:{pageTitle:"Choose Service"}}).state("app.television.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}}).state("app.television.payment",{url:"/payment",templateUrl:b+"payment.html",data:{pageTitle:"Confirm Payment"}}).state("app.television.success",{url:"/success",templateUrl:b+"success.html",data:{pageTitle:"Payment Successful"}})}]),angular.module("app.television").controller("TelevisionCtrl",["$scope","$state","Transaction","STRIPE_KEY",function(a,b,c,d){"app.television.choose"!==b.current.name&&b.transitionTo("app.television.choose"),a.details={recipient:{},accountNumber:"",preferredContactMethod:"MAIL",reference:"Payment June"},a.details.serviceFee=0,a.chooseState=!0,a.errors=[],a.paymentSaveSuccess=!0;var e=function(a){return Math.ceil(100*a)/100},f=function(){return a.errors=[],"DST"!==a.details.billType&&"GOT"!==a.details.billType?(a.errors.push("Please select a TV service provider"),!1):a.details.accountNumber.toString().length<8||isNaN(a.details.accountNumber)?!0:isNaN(a.details.amountGhs)||parseInt(a.details.amountGhs)<50||parseInt(a.details.amountGhs>5e3)?(a.errors.push("Amount can only be more than GHS 50 and less than GHS 5000"),!1):!0},g=function(){return a.errors=[],!a.details.recipient.phoneNumber||a.details.recipient.phoneNumber.length<10?(a.errors.push("Please enter a valid phone number"),!1):!0};a.reSavePayment=function(){if(!a.paymentSaveSuccess){var d={stripeToken:a.stripeToken.id,transactionId:a.details.transactionId,type:"BILL"};c.savePayment(d).then(function(){a.paymentSaveSuccess=!0,b.transitionTo("app.television.success")},function(){a.paymentSaveSuccess=!1})}},c.getPricing().then(function(b){a.pricing=b},function(){}),c.getReferral().then(function(b){a.referral=b},function(){}),a.calculatePricing=function(){a.details.amountUsd=e(a.details.amountGhs/a.pricing.usdGhs),a.details.serviceFee=e(a.pricing.percentualFee*a.details.amountUsd+a.pricing.fixedFee),a.details.chargeUsd=e(a.details.amountUsd+a.details.serviceFee)},a.setDetails=function(){f()&&(a.recipientState=!0,b.transitionTo("app.television.recipient"))},a.addRecipient=function(){g()&&(a.paymentState=!0,c.addBill(a.details).then(function(c){a.details.transactionId=c.transactionId,b.transitionTo("app.television.payment")},function(){}))},a.getProvider=function(){return"DST"===a.details.provider?"DSTV":"GOTV"},a.confirm=function(){if(a.pricing){var e=StripeCheckout.configure({key:d,image:"/icon-128.png",token:function(d){a.stripeToken=d;var e={stripeToken:d.id,transactionId:a.details.transactionId,type:"BILL"};c.savePayment(e).then(function(){a.paymentSaveSuccess=!0,b.transitionTo("app.television.success")},function(){a.paymentSaveSuccess=!1})}});e.open({name:"BeamPay",description:"GHS "+a.details.amountGhs+" on "+a.getProvider(),amount:100*a.details.chargeUsd})}return!1}}]),angular.module("app.airtime",[]).config(["$stateProvider",function(a){var b="apps/airtime/views/";a.state("app.airtime",{url:"^/airtime",templateUrl:b+"layouts/airtime.html"}).state("app.airtime.choose",{url:"/choose",templateUrl:b+"choose.html",data:{pageTitle:"Choose Service"}}).state("app.airtime.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}}).state("app.airtime.payment",{url:"/payment",templateUrl:b+"payment.html",data:{pageTitle:"Confirm Payment"}}).state("app.airtime.success",{url:"/success",templateUrl:b+"success.html",data:{pageTitle:"Payment Successful"}})}]),angular.module("app.airtime").controller("AirtimeCtrl",["$scope","$state","Transaction","STRIPE_KEY",function(a,b,c,d){"app.airtime.choose"!==b.current.name&&b.transitionTo("app.airtime.choose"),a.details={recipient:{},accountNumber:"",preferredContactMethod:"MAIL"},a.details.serviceFee=0,a.chooseState=!0,a.errors=[],a.paymentSaveSuccess=!0;var e=function(a){return Math.ceil(100*a)/100},f=function(){return a.errors=[],"AIR"!==a.details.network&&"MTN"!==a.details.network&&"TIG"!==a.details.network&&"VOD"!==a.details.network?(a.errors.push("Please select an airtime provider"),!1):isNaN(a.details.amountGhs)||parseInt(a.details.amountGhs)<10||parseInt(a.details.amountGhs>500)?(a.errors.push("Amount can only be more than GHS 50 and less than GHS 5000"),!1):!0},g=function(){return a.errors=[],!a.details.recipient.phoneNumber||a.details.recipient.phoneNumber.length<10?(a.errors.push("Please enter a valid phone number"),!1):!0};a.reSavePayment=function(){if(!a.paymentSaveSuccess){var d={stripeToken:a.stripeToken.id,transactionId:a.details.transactionId,type:"BILL"};c.savePayment(d).then(function(){a.paymentSaveSuccess=!0,b.transitionTo("app.airtime.success")},function(){a.paymentSaveSuccess=!1})}},c.getPricing().then(function(b){a.pricing=b},function(){}),c.getReferral().then(function(b){a.referral=b},function(){}),a.calculatePricing=function(){a.details.amountUsd=e(a.details.amountGhs/a.pricing.usdGhs),a.details.serviceFee=e(a.pricing.percentualFee*a.details.amountUsd+a.pricing.fixedFee),a.details.chargeUsd=e(a.details.amountUsd+a.details.serviceFee)},a.setDetails=function(){f()&&(a.recipientState=!0,b.transitionTo("app.airtime.recipient"))},a.addRecipient=function(){g()&&(a.paymentState=!0,c.addBill(a.details).then(function(c){a.details.transactionId=c.transactionId,b.transitionTo("app.airtime.payment")},function(){}))},a.getProvider=function(){return"ECG"===a.details.provider?"Electricity":"Water"},a.confirm=function(){if(a.pricing){var e=StripeCheckout.configure({key:d,image:"/icon-128.png",token:function(d){a.stripeToken=d;var e={stripeToken:d.id,transactionId:a.details.transactionId,type:"BILL"};c.savePayment(e).then(function(){a.paymentSaveSuccess=!0,b.transitionTo("app.airtime.success")},function(){a.paymentSaveSuccess=!1})}});e.open({name:"BeamPay",description:"GHS "+a.details.amountGhs+" on "+a.getProvider(),amount:100*a.details.chargeUsd})}return!1}}]),angular.module("app.utility",[]).config(["$stateProvider",function(a){var b="apps/utility/views/";a.state("app.utility",{url:"^/utility",templateUrl:b+"layouts/utility.html"}).state("app.utility.choose",{url:"/choose",templateUrl:b+"choose.html",data:{pageTitle:"Choose Service"}}).state("app.utility.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}}).state("app.utility.payment",{url:"/payment",templateUrl:b+"payment.html",data:{pageTitle:"Confirm Payment"}}).state("app.utility.success",{url:"/success",templateUrl:b+"success.html",data:{pageTitle:"Payment Successful"}})}]),angular.module("app.utility").controller("UtilityCtrl",["$scope","$state","Transaction","STRIPE_KEY",function(a,b,c,d){"app.utility.choose"!==b.current.name&&b.transitionTo("app.utility.choose"),a.details={recipient:{},accountNumber:"",preferredContactMethod:"MAIL",reference:"Payment June"},a.details.serviceFee=0,a.chooseState=!0,a.errors=[],a.paymentSaveSuccess=!0;var e=function(a){return Math.ceil(100*a)/100},f=function(){return a.errors=[],"ECG"!==a.details.billType&&"GWC"!==a.details.billType?(a.errors.push("Please select a Utility service provider"),!1):isNaN(a.details.amountGhs)||parseInt(a.details.amountGhs)<50||parseInt(a.details.amountGhs>5e3)?(a.errors.push("Amount can only be more than GHS 50 and less than GHS 5000"),!1):!0},g=function(){return a.errors=[],!a.details.recipient.phoneNumber||a.details.recipient.phoneNumber.length<10?(a.errors.push("Please enter a valid phone number"),!1):!0};a.reSavePayment=function(){if(!a.paymentSaveSuccess){var d={stripeToken:a.stripeToken.id,transactionId:a.details.transactionId,type:"BILL"};c.savePayment(d).then(function(){a.paymentSaveSuccess=!0,b.transitionTo("app.utility.success")},function(){a.paymentSaveSuccess=!1})}},c.getPricing().then(function(b){a.pricing=b},function(){}),c.getReferral().then(function(b){a.referral=b},function(){}),a.calculatePricing=function(){a.details.amountUsd=e(a.details.amountGhs/a.pricing.usdGhs),a.details.serviceFee=e(a.pricing.percentualFee*a.details.amountUsd+a.pricing.fixedFee),a.details.chargeUsd=e(a.details.amountUsd+a.details.serviceFee)},a.setDetails=function(){f()&&(a.recipientState=!0,b.transitionTo("app.utility.recipient"))},a.addRecipient=function(){g()&&(a.paymentState=!0,c.addBill(a.details).then(function(c){a.details.transactionId=c.transactionId,b.transitionTo("app.utility.payment")},function(){}))},a.getProvider=function(){return"ECG"===a.details.provider?"Electricity":"Water"},a.confirm=function(){if(a.pricing){var e=StripeCheckout.configure({key:d,image:"/icon-128.png",token:function(d){a.stripeToken=d;var e={stripeToken:d.id,transactionId:a.details.transactionId,type:"BILL"};c.savePayment(e).then(function(){a.paymentSaveSuccess=!0,b.transitionTo("app.utility.success")},function(){a.paymentSaveSuccess=!1})}});e.open({name:"BeamPay",description:"GHS "+a.details.amountGhs+" on "+a.getProvider(),amount:100*a.details.chargeUsd})}return!1}}]),angular.module("app.internet",[]).config(["$stateProvider",function(a){var b="apps/internet/views/";a.state("app.internet",{url:"^/internet",templateUrl:b+"layouts/internet.html"}).state("app.internet.choose",{url:"/choose",templateUrl:b+"choose.html",data:{pageTitle:"Choose Service"}}).state("app.internet.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}}).state("app.internet.payment",{url:"/payment",templateUrl:b+"payment.html",data:{pageTitle:"Confirm Payment"}}).state("app.internet.success",{url:"/success",templateUrl:b+"success.html",data:{pageTitle:"Payment Successful"}})}]),angular.module("app.internet").controller("InternetCtrl",["$scope","$state","Transaction","STRIPE_KEY",function(a,b,c,d){"app.internet.choose"!==b.current.name&&b.transitionTo("app.internet.choose"),a.details={recipient:{},accountNumber:"",preferredContactMethod:"MAIL"},a.details.serviceFee=0,a.chooseState=!0,a.errors=[],a.paymentSaveSuccess=!0;var e=function(a){return Math.ceil(100*a)/100},f=function(){return a.errors=[],"SRF"!==a.details.billType&&"VOB"!==a.details.billType?(a.errors.push("Please select an Internet service provider"),!1):isNaN(a.details.amountGhs)||parseInt(a.details.amountGhs)<50||parseInt(a.details.amountGhs>5e3)?(a.errors.push("Amount can only be more than GHS 50 and less than GHS 5000"),
!1):!0},g=function(){return a.errors=[],!a.details.recipient.phoneNumber||a.details.recipient.phoneNumber.length<10?(a.errors.push("Please enter a valid phone number"),!1):!0};a.reSavePayment=function(){if(!a.paymentSaveSuccess){var d={stripeToken:a.stripeToken.id,transactionId:a.details.transactionId,type:"BILL"};c.savePayment(d).then(function(){a.paymentSaveSuccess=!0,b.transitionTo("app.internet.success")},function(){a.paymentSaveSuccess=!1})}},c.getPricing().then(function(b){a.pricing=b},function(){}),c.getReferral().then(function(b){a.referral=b},function(){}),a.calculatePricing=function(){a.details.amountUsd=e(a.details.amountGhs/a.pricing.usdGhs),a.details.serviceFee=e(a.pricing.percentualFee*a.details.amountUsd+a.pricing.fixedFee),a.details.chargeUsd=e(a.details.amountUsd+a.details.serviceFee)},a.setDetails=function(){f()&&(a.recipientState=!0,b.transitionTo("app.internet.recipient"))},a.addRecipient=function(){g()&&(a.paymentState=!0,c.addBill(a.details).then(function(c){a.details.transactionId=c.transactionId,b.transitionTo("app.internet.payment")},function(){}))},a.getProvider=function(){return"SRF"===a.details.provider?"Surfline":"Vodafone"},a.confirm=function(){if(a.pricing){var e=StripeCheckout.configure({key:d,image:"/icon-128.png",token:function(d){a.stripeToken=d;var e={stripeToken:d.id,transactionId:a.details.transactionId,type:"BILL"};c.savePayment(e).then(function(){a.paymentSaveSuccess=!0,b.transitionTo("app.internet.success")},function(){a.paymentSaveSuccess=!1})}});e.open({name:"BeamPay",description:"GHS "+a.details.amountGhs+" on "+a.getProvider(),amount:100*a.details.chargeUsd})}return!1}}]),angular.module("app.school",[]).config(["$stateProvider",function(a){var b="apps/school/views/";a.state("app.school",{url:"^/school",templateUrl:b+"layouts/school.html"}).state("app.school.details",{url:"/details",templateUrl:b+"details.html",data:{pageTitle:"Choose Service"}}).state("app.school.contact",{url:"/contact",templateUrl:b+"contact.html",data:{pageTitle:"contact Details"}}).state("app.school.request",{url:"/request",templateUrl:b+"request.html",data:{pageTitle:"Confirm Request"}}).state("app.school.success",{url:"/success",templateUrl:b+"success.html",data:{pageTitle:"Request Successful"}})}]),angular.module("app.school").controller("SchoolCtrl",["$scope","$state","Transaction","STRIPE_KEY",function(a,b,c,d){"app.school.details"!==b.current.name&&b.transitionTo("app.school.details"),a.details={wardName:{},preferredContactMethod:"MAIL"},a.details.serviceFee=0,a.detailsState=!0,a.errors=[],a.paymentSaveSuccess=!0,a.setDetails=function(){a.contactState=!0,b.transitionTo("app.school.contact")},a.setMethod=function(){a.requestState=!0,b.transitionTo("app.school.request")},a.makePayment=function(){a.details.wardName=a.details.wardName.firstName+" "+a.details.wardName.middleName+" "+a.details.wardName.lastName,c.addSchool(a.details).then(function(c){a.details.transactionId=c.transactionId,b.transitionTo("app.school.success")},function(){})}}]);