"use strict";angular.module("app",["ngCookies","ngResource","ui.router","ngSanitize","ngTouch","ngAnimate","ui.bootstrap","ui.bootstrap.datetimepicker","angularMoment","angular-loading-bar","app.config","app.utils","app.general","app.auth","app.transaction","app.settings","app.airtime","app.television","app.utility","app.internet","app.school","app.valet","app.gift"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){c.hashPrefix("!"),a.state("app",{url:"/",templateUrl:"apps/transaction/views/layouts/transaction.html",data:{pageTitle:"Welcome"}}),b.otherwise("/home")}]).run(["$rootScope","$anchorScroll","Auth","$state",function(a,b,c,d){a.$on("$stateChangeSuccess",function(e,f){angular.isDefined(f.data.pageTitle)&&(angular.isDefined(f.data.pageSubtitle)?a.pageTitle=f.data.pageSubtitle+" :: "+f.data.pageTitle+" | BeamPay":a.pageTitle=f.data.pageTitle+" | BeamPay");for(var g=["signin","signup","activate","confirmEmail","forgot","signupComplete","landing","hiw","about","resetPassword"],h=!0,i=0;i<g.length;i++)f.name===g[i]&&(h=!1);h&&!c.isLoggedIn()&&d.transitionTo("signin",{next:d.current.name}),b()}),(new WOW).init()}]),angular.module("app.config",[]).constant("name","staging").constant("API_SERVER","https://api-dev.beampay.co/api/v1/").constant("FACEBOOK_CLIENT_ID",0x5ae40eac7c5e6).constant("STRIPE_KEY","pk_test_zYX7SkWrbMZCszrPcoDPu4iI"),angular.module("app").controller("HeaderCtrl",["$scope","$state","Auth","Persist",function(a,b,c,d){c.isLoggedIn()?a.loggedin=!0:a.loggedin=!1,a.logoutInProgress=!1,a.logout=function(){a.logoutInProgress=!0,c.signout().then(function(){a.logoutInProgress=!1,a.loggedin=!1,b.transitionTo("landing")})},a.signup=function(){b.transitionTo("signup")},a.signin=function(){b.transitionTo("signin")},a.dashboard=function(){b.transitionTo("app")},a.currentUser=d.getUser()}]),angular.module("app.utils",[]).service("Persist",["$window","$cookieStore",function(a,b){var c="userid",d="token",e="email",f="firstName",g="lastName",h="complete",i="pricing",j=function(a,e,f){b.put(c,a),b.put(d,e),b.put(h,f)},k=function(a,c){b.put(f,a),b.put(g,c)},l=function(){b.remove(c),b.remove(d),b.remove(e),b.remove(f),b.remove(g),b.remove(h)},m=function(){return{userid:b.get(c),token:b.get(d),firstName:b.get(f),lastName:b.get(g),complete:b.get(h)}},n=function(){return b.put(h,!0),!0},o=function(a){return b.put(e,a),!0},p=function(){return b.get(e)},q=function(a){b.put(i,JSON.stringify(a))},r=function(){return JSON.parse(b.get(i))};return{saveUser:function(a,b,c){return j(a,b,c)},saveUserName:function(a,b){return k(a,b)},getUser:function(){return m()},deleteUser:function(){return l()},completeUser:function(){return n()},saveEmail:function(a){return o(a)},getEmail:function(){return p()},savePricing:function(a){return q(a)},getPricing:function(){return r()}}}]),angular.module("app.general",[]).config(["$stateProvider",function(a){var b="apps/general/views/";a.state("landing",{url:"/home",templateUrl:b+"landing/landing.html",data:{pageTitle:"Beam - Care for loved ones in Ghana quickly and affordably"}}).state("hiw",{url:"/how",templateUrl:b+"hiw/hiw.html",data:{pageTitle:"How it works"}}).state("about",{url:"/about",templateUrl:b+"about/about.html",data:{pageTitle:"About BeamPay"}})}]),angular.module("app.general").controller("NotifyCtrl",["$scope","$modal",function(a,b){a.open=function(){b.open({templateUrl:"apps/general/views/landing/modals/_email.html",controller:"ModalCtrl"})}}]),angular.module("app.general").controller("ModalCtrl",["$scope","$modalInstance","Modal","$state",function(a,b,c,d){a.ok=function(){a.fromName&&a.fromEmail&&a.toName&&a.toEmail&&(a.loading=!0,c.sendEmail(a.fromName,a.fromEmail,a.toName,a.toEmail).then(function(){a.loading=!1,b.close()},function(b){a.loading=!1,a.err=b}))},a.cancel=function(){b.dismiss(),d.transitionTo("app")}}]),angular.module("app.general").service("Modal",["$http","$q",function(a,b){var c=function(c,d,e,f){var g=b.defer();return a.post("/email",{fromname:c,replyto:d,toname:e,to:f}).success(function(){g.resolve()}).error(function(a){g.reject(a)}),g.promise};return{sendEmail:function(a,b,d,e){return c(a,b,d,e)}}}]),angular.module("app.auth",["satellizer"]).config(["$stateProvider","$httpProvider","$authProvider","API_SERVER","FACEBOOK_CLIENT_ID",function(a,b,c,d,e){var f="/auth/",g="apps/auth/views/";a.state("signup",{url:f+"signup",templateUrl:g+"signup.html",data:{pageTitle:"Signup"}}).state("signupComplete",{url:f+"signup/complete",templateUrl:g+"signupComplete.html",data:{pageTitle:"Signup Complete"}}).state("signin",{url:f+"signin/?next",templateUrl:g+"signin.html",data:{pageTitle:"Signin"}}).state("facebookredirect",{url:f+"facebook-redirect",templateUrl:g+"facebookRedirect.html",data:{pageTitle:"Loggin In"}}).state("activate",{url:f+"activate/:key/",templateUrl:g+"activate.html",data:{pageTitle:"Activate"}}).state("settings",{url:f+"settings",templateUrl:g+"settings.html",data:{pageTitle:"Settings"}}).state("settings.email",{url:f+"settings/email",templateUrl:g+"changeEmail.html",data:{pageTitle:"Email Settings"}}).state("settings.password",{url:f+"settings/password",templateUrl:g+"password.html",data:{pageTitle:"Password Settings"}}).state("forgot",{url:f+"forgot",templateUrl:g+"forgot.html",data:{pageTitle:"Forgot Password"}}).state("resetPassword",{url:f+"forgot/:key/",templateUrl:g+"resetPassword.html",data:{pageTitle:"Reset Password"}}),b.interceptors.push("AuthInterceptor"),c.baseUrl=d,c.loginRedirect="/auth/facebook-redirect",c.facebook({clientId:e,url:"account/signin/facebook/"})}]),angular.module("app.auth").controller("SignupCtrl",["$scope","$state","$auth","Auth","Error",function(a,b,c,d,e){a.signup={},a.signup.submit=function(){a.signup.errors=[];var c=a.signup.email,f=a.signup.pass1,g=a.signup.pass2,h=a.signup.privacy;return c&&f&&g&&h?f!==g?void a.signup.errors.push("Passwords don't match"):void d.signup(c,f,g,h).then(function(){b.transitionTo("signupComplete")},function(b){a.signup.errors=e.signup(b)}):void a.signup.errors.push("All fields required")},a.signup.fb=function(){c.authenticate("facebook",{acceptedPrivacyPolicy:!0}).then(function(a){d.persist(a.data.id,a.data.token,a.data.complete),d.saveName(a.data.firstName,a.data.lastName)},function(b){a.signup.errors=e.signInFb(b.data)})},$(".show-email").click(function(){$("#sign-form").slideToggle()})}]),angular.module("app.auth").controller("SignInCtrl",["$scope","$state","$stateParams","$window","$auth","Auth","Error",function(a,b,c,d,e,f,g){a.signIn={},a.signIn.submit=function(){a.signIn.errors=[];var d=a.signIn.email,e=a.signIn.pass;return a.signIn.email&&a.signIn.pass?void f.signIn(d,e).then(function(a){if(a){var d=c.next;d?b.transitionTo(d):b.transitionTo("app")}else b.transitionTo("onboard.name")},function(b){a.signIn.errors=g.signIn(b)}):void a.signIn.errors.push("All fields required")},a.signIn.fb=function(){e.authenticate("facebook",{acceptedPrivacyPolicy:!0}).then(function(a){f.persist(a.data.id,a.data.token,a.data.complete),f.saveName(a.data.firstName,a.data.lastName)},function(b){a.signIn.errors=g.signInFb(b.data)})},a.forgot=function(){b.transitionTo("forgot")},$(".show-email").click(function(){$("#sign-form").slideToggle()})}]),angular.module("app.auth").controller("SignoutCtrl",["$scope","$state","Auth",function(a,b,c){a.signout=function(){c.signout().then(function(){b.transitionTo("landing")},function(){b.transitionTo("landing")})}}]),angular.module("app.auth").controller("ActivateCtrl",["$scope","$state","$stateParams","Auth","Error",function(a,b,c,d,e){a.activate={};var f=c.key;f?d.activate(f).then(function(){b.transitionTo("onboard.name")},function(b){a.activate.errors=e.activate(b)}):b.transitionTo("landing")}]),angular.module("app.auth").controller("ActivateResendCtrl",["$state","$scope","Auth","Error","Persist",function(a,b,c,d,e){e.getEmail()||a.transitionTo("signin"),b.activateResend={},b.activateResend.submit=function(){c.activateResend().then(function(){b.activateResend.success=!0},function(a){b.activateResend.errors=d.activateResend(a)})}}]),angular.module("app.auth").controller("ChangeEmailCtrl",["$scope","Settings","Error",function(a,b,c){a.changeEmail={},a.changeEmail.submit=function(){a.changeEmail.errors=[];var d=a.changeEmail.email;return d?void b.changeEmail(d).then(function(){a.changeEmail.success=!0},function(b){a.changeEmail.errors=c.changeEmail(b)}):void a.changeEmail.errors.push("Email required")}}]),angular.module("app.auth").controller("ConfirmEmailCtrl",["$scope","$state","$stateParams","Settings","Error",function(a,b,c,d,e){a.confirmEmail={};var f=c.key;f?d.confirmEmail(f).then(function(){a.confirmEmail.success=!0},function(b){a.confirmEmail.errors=e.confirmEmail(b)}):b.transitionTo("landing")}]),angular.module("app.auth").controller("PasswordCtrl",["$scope","Settings","Error",function(a,b,c){a.password={},b.isPassword().then(function(b){b?a.password.passwordExists=!0:a.password.passwordNoExists=!0},function(a){c.isPassword(a)}),a.changePassword={},a.changePassword.submit=function(){a.changePassword.errors=[];var d=a.changePassword.oldPass,e=a.changePassword.pass1,f=a.changePassword.pass2;return d&&e&&f?e!==f?void a.changePassword.errors.push("New passwords don't match"):void b.changePassword(d,e,f).then(function(){a.changePassword.success=!0},function(b){a.changePassword.errors=c.changePassword(b)}):void a.changePassword.errors.push("All fields required")},a.setPassword={},a.setPassword.submit=function(){a.setPassword.errors=[];var d=a.setPassword.pass1,e=a.setPassword.pass2;return d&&e?d!==e?void a.setPassword.errors.push("Passwords don't match"):void b.setPassword(d,e).then(function(){a.setPassword.success=!0},function(b){a.setPassword.errors=c.setPassword(b)}):void a.setPassword.errors.push("All fields required")}}]),angular.module("app.auth").controller("ForgotCtrl",["$scope","Settings","Error",function(a,b,c){a.forgot={},a.forgot.submit=function(){a.forgot.errors=[];var d=a.forgot.email;return d?void b.requestResetPassword(d).then(function(){a.forgot.email=d,a.forgot.success=!0},function(b){a.forgot.errors=c.forgot(b)}):void a.forgot.errors.push("Email required")}}]),angular.module("app.auth").controller("ResetPasswordCtrl",["$scope","$state","$stateParams","Settings","Error",function(a,b,c,d,e){var f=c.key;f?(a.resetPassword={},d.showResetPassword(f).then(function(){a.resetPassword.can=!0},function(){a.resetPassword.cannot=!0}),a.resetPassword.submit=function(){a.resetPassword.errors=[];var b=a.resetPassword.pass1,c=a.resetPassword.pass2;return b&&c?b!==c?void a.resetPassword.errors.push("Passwords don't match"):void d.resetPassword(f,b,c).then(function(){a.resetPassword.success=!0},function(b){a.resetPassword.errors=e.resetPassword(b)}):void a.resetPassword.errors.push("All fields required")}):b.transitionTo("landing")}]),angular.module("app.auth").controller("FacebookCtrl",["$state","Persist",function(a,b){b.getUser().complete?a.transitionTo("app"):a.transitionTo("onboard.name")}]),angular.module("app.auth").service("Auth",["$cookieStore","$http","$q","Persist","API_SERVER",function(a,b,c,d,e){e+="account/";var f=function(a,b,c){d.saveUser(a,b,c)},g=function(a,b){d.saveUserName(a,b)},h=function(a,f,g,h){var i=e+"signup/",j=c.defer();return d.deleteUser(),b.post(i,{email:a,password1:f,password2:g,acceptedPrivacyPolicy:h}).success(function(){d.saveEmail(a),j.resolve()}).error(function(a){j.reject(a)}),j.promise},i=function(a,h){var i=e+"signin/",j=c.defer();return d.deleteUser(),b.post(i,{email:a,password:h}).success(function(a){f(a.id,a.token,a.complete),a.complete&&g(a.firstName,a.lastName),j.resolve(a.complete)}).error(function(a){j.reject(a)}),j.promise},j=function(){var a=e+"signout/",f=c.defer();return b.post(a).success(function(){d.deleteUser(),f.resolve()}).error(function(a){f.reject(a)}),f.promise},k=function(a){var d=e+"activate/"+a+"/",g=c.defer();return b.get(d).success(function(a){f(a.id,a.token,!1),g.resolve()}).error(function(a){g.reject(a)}),g.promise},l=function(){var a=e+"activate/resend/",f=c.defer();return b.post(a,{email:d.getEmail()}).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise},m=function(){return d.getUser().userid?!0:!1};return{persist:function(a,b,c){return f(a,b,c)},saveName:function(a,b){return g(a,b)},signup:function(a,b,c,d){return h(a,b,c,d)},signIn:function(a,b){return i(a,b)},signout:function(){return j()},activate:function(a){return k(a)},activateResend:function(a){return l(a)},isLoggedIn:function(){return m()}}}]),angular.module("app.auth").service("Settings",["$http","$q","Persist","API_SERVER",function(a,b,c,d){d+="account/";var e=function(c){var e=d+"email/",f=b.defer();return a.post(e,{email:c}).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise},f=function(c){var e=d+"confirm-email/"+c+"/",f=b.defer();return a.get(e).success(function(){f.resolve()}).error(function(a){console.log(a),f.reject(a)}),f.promise},g=function(){var c=d+"password/set/",e=b.defer();return a.get(c).success(function(a){e.resolve(a.passwordSet)}).error(function(a){e.reject(a)}),e.promise},h=function(e,f,g){var h=d+"password/",i=b.defer();return a.post(h,{oldPassword:e,password1:f,password2:g}).success(function(a){var b=c.getUser().userid;c.saveUser(b,a.token),i.resolve()}).error(function(a){i.reject(a)}),i.promise},i=function(c,e){var f=d+"password/set/",g=b.defer();return a.post(f,{password1:c,password2:e}).success(function(){g.resolve()}).error(function(a){g.reject(a)}),g.promise},j=function(c){var e=d+"password/reset/",f=b.defer();return a.post(e,{email:c}).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise},k=function(c){var e=d+"password/reset/confirm/"+c+"/",f=b.defer();return a.get(e).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise},l=function(c,e,f){var g=d+"password/reset/confirm/"+c+"/",h=b.defer();return a.post(g,{password1:e,password2:f}).success(function(){h.resolve()}).error(function(a){h.reject(a)}),h.promise};return{changeEmail:function(a){return e(a)},confirmEmail:function(a){return f(a)},changePassword:function(a,b,c){return h(a,b,c)},isPassword:function(a){return g(a)},setPassword:function(a,b){return i(a,b)},requestResetPassword:function(a){return j(a)},showResetPassword:function(a){return k(a)},resetPassword:function(a,b,c){return l(a,b,c)}}}]),angular.module("app.auth").service("Error",function(){var a="Oops. Something went wrong! It doesn't appear to have affected your data, but our technical staff have been automatically notified and will be looking into this with the utmost urgency.",b=function(b){var c=[];return b?b.password1&&"1"===b.password1[0]?c.push("Password must be at least 8 characters long, contain at least one numeric digit."):b.email&&"4"===b.email[0]?c.push("An account with this email has already been created. Please login if you are the owner of this email. Else enter another email."):b.email&&"5"===b.email[0]?c.push("An activation link has been sent to your email. Please check and activate your account"):b.nonFieldErrors&&"2"===b.nonFieldErrors[0]?c.push("The two passwords do not match"):b.acceptedPrivacyPolicy&&"3"===b.acceptedPrivacyPolicy[0]?c.push("Plese accept the Privacy Policy to continue"):c.push(a):c.push(a),c},c=function(a){var b=[];return a.nonFieldErrors&&("11"===a.nonFieldErrors[0]?b.push("Sorry, your account has been disabled"):"13"===a.nonFieldErrors[0]?b.push("Your email or password is incorrect. Please check and try again"):"0"===a.nonFieldErrors[0]?b.push("Please enter both email and password"):"14"===a.nonFieldErrors[0]?b.push("Admin accounts not allowed"):"12"===a.nonFieldErrors[0]&&b.push("An activation link has been sent to your email. Please check and activate your account")),b},d=function(){var b=[];return b.push(a),b},e=function(b){var c=[];return b?"6"===b.detail?c.push("The actiivation link you used was invalid. Please check and try again"):"7"===b.detail&&c.push("The activation link you used has expired. Please try signing up again"):c.push(a),c},f=function(b){var c=[];return b?"9"===b.detail?c.push("Sorry, this email is not recognized. Are you trying to signup? Please click on the signup link on the header."):"10"===b.detail?c.push("You account has already been activated. Please try loggin in instead"):"11"===b.detail&&c.push("Sorry, your account has been disabled"):c.push(a),c},g=function(b){var c=[];return b?"0"===b.detail?c.push("Please enter a valid email"):"4"===b.detail?c.push("An account with this email has already been created. Please login if you are the owner of this email. Else enter another email."):"15"===b.detail&&c.push("Your email has not been changed"):c.push(a),c},h=function(b){var c=[];return b?"0"===b.detail&&c.push("Please enter a valid email"):c.push(a),c},i=function(){var b=[];return b.push(a),b},j=function(b){var c=[];return b?b.oldPassword&&"16"===b.oldPassword[0]?c.push("Sorry, your old Password is incorrect"):b.password1&&"1"===b.password1[0]?c.push("Password must be at least 8 characters long, contain at least one numeric digit."):b.nonFieldErrors&&"2"===b.nonFieldErrors[0]?c.push("Passwords don't match"):"20"===b.detail&&c.push("Passwords not set"):c.push(a),c},k=function(a){var b=[];return"0"===a.detail?b.push("Invalid Parameters"):a.password1&&"1"===a.password1[0]?b.push("Weak pass"):a.nonFieldErrors&&"2"===a.nonFieldErrors[0]?b.push("The two passwords do not match"):"21"===a.detail&&b.push("A password has already been set. If you cannot remember please logout and send a reset password to your email."),b},l=function(b){var c=[];return b?"9"===b.detail?c.push("Sorry, this email is not recognized. Are you trying to signup? Please click on the signup link on the header."):"11"===b.detail?c.push("Sorry your account is disabled"):"12"===b.detail&&c.push("An activation link has been sent to your email. Please check and activate your account"):c.push(a),c},m=function(b,c){var d=[];return 451==c?d.push("Your country is not supported. We'll let you know when we support it"):0==b.detail?d.push("Some of the information you provided is incorrect. Please check and try again."):1==b.detail?d.push("The international exchange rate has changed. Please choose your service again."):2==b.detail?d.push("Your profile is incomplete please update your details in your settings"):d.push(a),d},n=function(a){var b=[];return 0==a.detail?b.push("Some of the information you provided is incorrect. Please check and try again."):2==a.detail&&b.push("You have entered an invalid referral code. Please try again"),b};return{signup:function(a){return b(a)},signIn:function(a){return c(a)},signInFb:function(a){return d(a)},activate:function(a){return e(a)},activateResend:function(a){return f(a)},changeEmail:function(a){return g(a)},confirmEmail:function(a){return h(a)},isPassword:function(a){return i(a)},changePassword:function(a){return j(a)},setPassword:function(a){return k(a)},forgot:function(a){return l(a)},transaction:function(a,b){return m(a)},setReferral:function(a){return n(a)}}}),angular.module("app.auth").service("AuthInterceptor",["$q","$location","Persist","API_SERVER",function(a,b,c,d){var e=function(a){var b=new RegExp("^"+d);if(a.url.match(b)){a.headers=a.headers||{};var e=c.getUser();e&&e.token&&(a.headers.Authorization="Token "+e.token)}return a},f=function(d){return 401===d.status&&(c.deleteUser(),b.path(b.path())),a.reject(d)};return{request:function(a){return e(a)},responseError:function(a){return f(a)}}}]),angular.module("app.settings",[]).config(["$stateProvider",function(a){var b="apps/settings/views/";a.state("onboard",{url:"/settings/onboard","abstract":"true",template:"<ui-view/>"}).state("onboard.name",{url:"/name",templateUrl:b+"onboardName.html",data:{pageTitle:"Onboarding - Name"}}).state("onboard.address",{url:"/address",templateUrl:b+"onboardAddress.html",data:{pageTitle:"Onboarding - Address"}})}]),angular.module("app.settings").controller("OnboardNameCtrl",["$scope","$state","Onboard","Error",function(a,b,c,d){a.settings={},c.getProfile().then(function(b){a.settings=b,a.settings.submit=e},function(){});var e=function(){a.settings.errors=[];var e=a.settings.firstName,f=a.settings.lastName;if(!e||!f)return void a.settings.errors.push("We need you to provide your full name.");var g=function(){c.saveName(e,f).then(function(){b.transitionTo("onboard.address")},function(){a.settings.errors.push("Some of the information you provided is invalid. Please check and try again.")})};a.settings.referralCode?c.setReferral(a.settings.referralCode).then(function(){g()},function(b){b.details&&1==b.details?g():a.settings.errors=d.setReferral(b)}):g()}}]),angular.module("app.settings").controller("OnboardAddressCtrl",["$scope","$state","Onboard","Persist",function(a,b,c,d){a.settings={date:{}},a.settings.country="US",a.settings.firstName=d.getUser().firstName,c.getProfile().then(function(b){a.settings=b.profile,a.settings.submit=e,a.settings.firstName=b.firstName,a.settings.lastName=b.lastName;var c=new Date(a.settings.dateOfBirth);a.settings.date={year:c.getFullYear().toString(),month:(c.getMonth()+1).toString(),day:c.getDate().toString()}},function(){});var e=function(){return a.settings.errors=[],a.settings.dateOfBirth=a.settings.date.year+"-"+a.settings.date.month+"-"+a.settings.date.day,a.settings.dateOfBirth&&a.settings.country&&a.settings.phoneNumber&&a.settings.street&&a.settings.city&&a.settings.postCode?void c.saveAddress(a.settings).then(function(){b.transitionTo("app")},function(){a.settings.errors.push("This page has errors")}):void a.settings.errors.push("We need you to fill all the fields.")}}]),angular.module("app.settings").service("Onboard",["$http","$q","API_SERVER","Persist",function(a,b,c,d){var e=function(e,f){var g=c+"account/profile/",h=b.defer();return a.put(g,{firstName:e,lastName:f}).success(function(){d.saveUserName(e,f),h.resolve()}).error(function(a){h.reject(a)}),h.promise},f=function(e){var f=c+"account/profile/",g=b.defer();return a.put(f,{profile:e}).success(function(){d.completeUser(),g.resolve()}).error(function(a){g.reject(a)}),g.promise},g=function(d){var e=c+"referral/add/",f=b.defer();return a.post(e,{code:d}).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise},h=function(){var d=c+"account/profile/",e=b.defer();return a.get(d).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise};return{saveName:function(a,b){return e(a,b)},saveAddress:function(a){return f(a)},setReferral:function(a){return g(a)},getProfile:function(){return h()}}}]),angular.module("app.transaction",[]).config(["$stateProvider",function(a){var b="apps/transaction/views/";a.state("app.transaction",{url:"^/transactions",templateUrl:b+"layouts/transactions.html"}).state("app.transaction.list",{url:"/",templateUrl:b+"transactionsList.html"}).state("app.transaction.details",{url:"/:transactionId/:transactionType",templateUrl:b+"transactionDetails.html"})}]),angular.module("app.transaction").controller("HomeCtrl",["$scope","Persist",function(a,b){a.currentUser=b.getUser()}]),angular.module("app.transaction").controller("TransactionDetailCtrl",["$scope","$stateParams","Transaction","TransactionUtil",function(a,b,c,d){console.log(b),b.transactionId&&b.transactionType&&c.getTransaction(b.transactionId,b.transactionType).then(function(c){a.transaction=c,a.transactionType=b.transactionType},function(){}),a.getDescription=function(a){return d.getDescription(a)},a.getComment=function(b){return"INIT"===b?d.getDescription({transactionType:a.transactionType,data:a.transaction}):b}}]).controller("TransactionCtrl",["$scope","TransactionUtil","Transaction",function(a,b,c){a.transactions=[],a.getDescription=function(a){return b.getDescription(a)},c.getTransactions().then(function(b){a.transactions=b},function(){})}]),angular.module("app.transaction").service("Transaction",["$http","$q","API_SERVER","Persist",function(a,b,c,d){var e=function(d,e){var f=c+d,g=b.defer();return a.post(f,e).success(function(a){g.resolve(a)}).error(function(a){g.reject(a)}),g.promise},f=function(){var e=c+"pricing/",f=b.defer();return a.get(e).success(function(a){d.savePricing(a),f.resolve(a)}).error(function(a){f.reject(a)}),f.promise},g=function(d){var e=c+d,f=b.defer();return a.get(e).success(function(a){f.resolve(a)}).error(function(a){f.reject(a)}),f.promise},h=function(){return g("referral/")},i=function(){return g("transaction/")},j=function(a,b){return g("transaction/"+a+"/?type="+b)},k=function(a){var b=d.getPricing();return a.exchangeRateId=b.exchangeRateId,a.serviceFeeId=b.serviceFeeId,e("transaction/add/airtime/",a)},l=function(a){var b=d.getPricing();return a.exchangeRateId=b.exchangeRateId,a.serviceFeeId=b.serviceFeeId,console.log(a),e("transaction/add/bill/",a)},m=function(a){return e("transaction/add/valet/",a)},n=function(a){return e("transaction/add/gift/",a)},o=function(a){return e("transaction/add/school/",a)},p=function(a){return console.log(a),e("payment/stripe/",a)};return{addAirtime:function(a){return k(a)},addBill:function(a){return l(a)},addValet:function(a){return m(a)},addGift:function(a){return n(a)},addSchool:function(a){return o(a)},getPricing:function(){return f()},getReferral:function(){return h()},savePayment:function(a){return p(a)},getTransaction:function(a,b){return j(a,b)},getTransactions:function(){return i()}}}]),angular.module("app.transaction").service("TransactionUtil",function(){var a=function(a){var b="";switch(a){case"DST":b="DSTv";break;case"GOT":b="GOTv";break;case"ECG":b="Electricity";break;case"GWC":b="Water";break;case"SRF":b="Surfline";break;case"VOB":case"VOD":b="Vodafone";break;case"AIR":b="Airtel";break;case"MTN":b="MTN";break;case"TIG":b="Tigo";break;case"CAKE":b="Cake";break;case"FLOW":b="Flowers";break;case"BASK":b="Gift basket";break;case"MISC":b="Something Else"}return b},b=function(b){return"billpayment"===b.transactionType?"GHS "+b.data.amountGhs+" billing on "+a(b.data.billType)+" for "+b.data.recipient.firstName+" "+b.data.recipient.lastName:"airtimetopup"===b.transactionType?"GHS "+b.data.amountGhs+" "+a(b.data.network)+" airtime for "+b.data.recipient.firstName+" "+b.data.recipient.lastName:"schoolfeepayment"===b.transactionType?b.data.wardName+" fees to "+b.data.school:"valettransaction"===b.transactionType?b.data.description:"gift"===b.transactionType?"Send "+a(b.data.giftType)+" to "+b.data.recipient.firstName+" "+b.data.recipient.lastName:void 0};return{getDescription:function(a){return b(a)},getFullName:function(b){return a(b)}}}),angular.module("app.television",[]).config(["$stateProvider",function(a){var b="apps/television/views/";a.state("app.television",{url:"^/television",templateUrl:b+"layouts/television.html"}).state("app.television.choose",{url:"/choose",templateUrl:b+"choose.html",data:{pageTitle:"Choose Service"}}).state("app.television.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}}).state("app.television.payment",{url:"/payment",templateUrl:b+"payment.html",data:{pageTitle:"Confirm Payment"}})}]),angular.module("app.television").controller("TelevisionCtrl",["$scope","$state","Transaction","STRIPE_KEY","$modal",function(a,b,c,d,e){a.details={recipient:{},accountNumber:"",preferredContactMethod:"MAIL",reference:"Payment June"},a.details.serviceFee=0,a.chooseState=!0,a.errors=[],a.paymentSaveSuccess=!0;var f=function(a){return Math.ceil(100*a)/100},g=function(){return a.errors=[],"DST"!==a.details.billType&&"GOT"!==a.details.billType?(a.errors.push("Please select a TV service provider"),!1):a.details.accountNumber.toString().length<8||isNaN(a.details.accountNumber)?(a.errors.push("The reference number has to be 8 digits long"),!1):isNaN(a.details.amountGhs)||parseInt(a.details.amountGhs)<50||parseInt(a.details.amountGhs>5e3)?(a.errors.push("Amount can only be more than GHS 50 and less than GHS 5000"),!1):!0},h=function(){return a.errors=[],!a.details.recipient.phoneNumber||a.details.recipient.phoneNumber.length<10?(a.errors.push("Please enter a valid phone number"),!1):!0};a.reSavePayment=function(){if(!a.paymentSaveSuccess){var b={stripeToken:a.stripeToken.id,transactionId:a.details.transactionId,type:"BILL"};c.savePayment(b).then(function(){a.paymentSaveSuccess=!0,e.open({templateUrl:"apps/transaction/views/successModal.html",controller:"ModalCtrl"})},function(){a.paymentSaveSuccess=!1})}},c.getPricing().then(function(b){a.pricing=b},function(){}),c.getReferral().then(function(b){a.referral=b},function(){}),a.calculatePricing=function(){a.details.amountUsd=f(a.details.amountGhs/a.pricing.usdGhs),a.details.serviceFee=f(a.pricing.percentualFee*a.details.amountUsd+a.pricing.fixedFee),a.details.chargeUsd=f(a.details.amountUsd+a.details.serviceFee)},a.setDetails=function(){g()&&(a.recipientState=!0,b.transitionTo("app.television.recipient"))},a.addRecipient=function(){h()&&(a.paymentState=!0,c.addBill(a.details).then(function(c){a.details.transactionId=c.transactionId,b.transitionTo("app.television.payment")},function(a){a.detail&&"2"==a.detail&&e.open({templateUrl:"apps/transaction/views/incompleteProfileModal.html",controller:"ModalCtrl"})}))},a.getProvider=function(){return"DST"===a.details.provider?"DSTV":"GOTV"},a.confirm=function(){if(a.pricing){var b=StripeCheckout.configure({key:d,image:"/icon-128.png",token:function(b){a.stripeToken=b;var d={stripeToken:b.id,transactionId:a.details.transactionId,type:"BILL"};c.savePayment(d).then(function(){a.paymentSaveSuccess=!0,e.open({templateUrl:"apps/transaction/views/successModal.html",controller:"ModalCtrl"})},function(){a.paymentSaveSuccess=!1})}});b.open({name:"BeamPay",description:"GHS "+a.details.amountGhs+" on "+a.getProvider(),amount:100*a.details.chargeUsd})}return!1}}]),angular.module("app.airtime",[]).config(["$stateProvider",function(a){var b="apps/airtime/views/";a.state("app.airtime",{url:"^/airtime",templateUrl:b+"layouts/airtime.html"}).state("app.airtime.choose",{url:"/choose",templateUrl:b+"choose.html",data:{pageTitle:"Choose Service"}}).state("app.airtime.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}}).state("app.airtime.payment",{url:"/payment",templateUrl:b+"payment.html",data:{pageTitle:"Confirm Payment"}})}]),angular.module("app.airtime").controller("AirtimeCtrl",["$scope","$state","Transaction","$modal","STRIPE_KEY",function(a,b,c,d,e){"app.airtime.choose"!==b.current.name&&b.transitionTo("app.airtime.choose"),a.details={recipient:{},preferredContactMethod:"MAIL"},a.details.serviceFee=0,a.chooseState=!0,a.errors=[],a.paymentSaveSuccess=!0;var f=function(a){return Math.ceil(100*a)/100},g=function(){return a.errors=[],"AIR"!==a.details.network&&"MTN"!==a.details.network&&"TIG"!==a.details.network&&"VOD"!==a.details.network?(a.errors.push("Please select an airtime provider"),!1):isNaN(a.details.amountGhs)||parseInt(a.details.amountGhs)<10||parseInt(a.details.amountGhs>500)?(a.errors.push("Amount can only be more than GHS 50 and less than GHS 5000"),!1):!0},h=function(){return a.errors=[],!a.details.recipient.phoneNumber||a.details.recipient.phoneNumber.length<10?(a.errors.push("Please enter a valid phone number"),!1):!0};a.reSavePayment=function(){if(!a.paymentSaveSuccess){var b={stripeToken:a.stripeToken.id,transactionId:a.details.transactionId,type:"AIRTIME"};c.savePayment(b).then(function(){a.paymentSaveSuccess=!0,d.open({templateUrl:"apps/transaction/views/successModal.html",controller:"ModalCtrl"})},function(){a.paymentSaveSuccess=!1})}},c.getPricing().then(function(b){a.pricing=b},function(){}),c.getReferral().then(function(b){a.referral=b},function(){}),a.calculatePricing=function(){a.details.amountUsd=f(a.details.amountGhs/a.pricing.usdGhs),a.details.serviceFee=f(a.pricing.percentualFee*a.details.amountUsd+a.pricing.fixedFee),a.details.chargeUsd=f(a.details.amountUsd+a.details.serviceFee)},a.setDetails=function(){g()&&(a.recipientState=!0,b.transitionTo("app.airtime.recipient"))},a.addRecipient=function(){h()&&(a.paymentState=!0,a.details.phoneNumber=a.details.recipient.phoneNumber,
c.addAirtime(a.details).then(function(c){a.details.transactionId=c.transactionId,b.transitionTo("app.airtime.payment")},function(a){a.detail&&"2"==a.detail&&d.open({templateUrl:"apps/transaction/views/incompleteProfileModal.html",controller:"ModalCtrl"})}))},a.getProvider=function(){return"MTN"===a.details.network?"MTN":"TIGO"===a.details.network?"TIGO":"AIRTEL"===a.details.network?"AIRTEL":"VODAFONE"},a.confirm=function(){if(a.pricing){var b=StripeCheckout.configure({key:e,image:"/icon-128.png",token:function(b){a.stripeToken=b;var e={stripeToken:b.id,transactionId:a.details.transactionId,type:"AIRTIME"};c.savePayment(e).then(function(){a.paymentSaveSuccess=!0,d.open({templateUrl:"apps/transaction/views/successModal.html",controller:"ModalCtrl"})},function(){a.paymentSaveSuccess=!1})}});b.open({name:"BeamPay",description:"GHS "+a.details.amountGhs+" on "+a.getProvider(),amount:100*a.details.chargeUsd})}return!1}}]),angular.module("app.utility",[]).config(["$stateProvider",function(a){var b="apps/utility/views/";a.state("app.utility",{url:"^/utility",templateUrl:b+"layouts/utility.html"}).state("app.utility.choose",{url:"/choose",templateUrl:b+"choose.html",data:{pageTitle:"Choose Service"}}).state("app.utility.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}}).state("app.utility.payment",{url:"/payment",templateUrl:b+"payment.html",data:{pageTitle:"Confirm Payment"}})}]),angular.module("app.utility").controller("UtilityCtrl",["$scope","$state","Transaction","$modal","STRIPE_KEY",function(a,b,c,d,e){"app.utility.choose"!==b.current.name&&b.transitionTo("app.utility.choose"),a.details={recipient:{},accountNumber:"",preferredContactMethod:"MAIL",reference:"Payment June"},a.details.serviceFee=0,a.chooseState=!0,a.errors=[],a.paymentSaveSuccess=!0;var f=function(a){return Math.ceil(100*a)/100},g=function(){return a.errors=[],"ECG"!==a.details.billType&&"GWC"!==a.details.billType?(a.errors.push("Please select a Utility service provider"),!1):a.details.accountNumber.length<13?(a.errors.push("Please enter a 13-digit account number"),!1):isNaN(a.details.amountGhs)||parseInt(a.details.amountGhs)<50||parseInt(a.details.amountGhs>5e3)?(a.errors.push("Amount can only be more than GHS 50 and less than GHS 5000"),!1):!0},h=function(){return a.errors=[],!a.details.recipient.phoneNumber||a.details.recipient.phoneNumber.length<10?(a.errors.push("Please enter a valid phone number"),!1):!0};a.reSavePayment=function(){if(!a.paymentSaveSuccess){var b={stripeToken:a.stripeToken.id,transactionId:a.details.transactionId,type:"BILL"};c.savePayment(b).then(function(){a.paymentSaveSuccess=!0,d.open({templateUrl:"apps/transaction/views/successModal.html",controller:"ModalCtrl"})},function(){a.paymentSaveSuccess=!1})}},c.getPricing().then(function(b){a.pricing=b},function(){}),c.getReferral().then(function(b){a.referral=b},function(){}),a.calculatePricing=function(){a.details.amountUsd=f(a.details.amountGhs/a.pricing.usdGhs),a.details.serviceFee=f(a.pricing.percentualFee*a.details.amountUsd+a.pricing.fixedFee),a.details.chargeUsd=f(a.details.amountUsd+a.details.serviceFee)},a.setDetails=function(){g()&&(a.recipientState=!0,b.transitionTo("app.utility.recipient"))},a.addRecipient=function(){h()&&(a.paymentState=!0,c.addBill(a.details).then(function(c){a.details.transactionId=c.transactionId,b.transitionTo("app.utility.payment")},function(a){a.detail&&"2"==a.detail&&d.open({templateUrl:"apps/transaction/views/incompleteProfileModal.html",controller:"ModalCtrl"})}))},a.getProvider=function(){return"ECG"===a.details.provider?"Electricity":"Water"},a.confirm=function(){if(a.pricing){var b=StripeCheckout.configure({key:e,image:"/icon-128.png",token:function(b){a.stripeToken=b;var e={stripeToken:b.id,transactionId:a.details.transactionId,type:"BILL"};c.savePayment(e).then(function(){a.paymentSaveSuccess=!0,d.open({templateUrl:"apps/transaction/views/successModal.html",controller:"ModalCtrl"})},function(){a.paymentSaveSuccess=!1})}});b.open({name:"BeamPay",description:"GHS "+a.details.amountGhs+" on "+a.getProvider(),amount:100*a.details.chargeUsd})}return!1}}]),angular.module("app.internet",[]).config(["$stateProvider",function(a){var b="apps/internet/views/";a.state("app.internet",{url:"^/internet",templateUrl:b+"layouts/internet.html"}).state("app.internet.choose",{url:"/choose",templateUrl:b+"choose.html",data:{pageTitle:"Choose Service"}}).state("app.internet.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}}).state("app.internet.payment",{url:"/payment",templateUrl:b+"payment.html",data:{pageTitle:"Confirm Payment"}})}]),angular.module("app.internet").controller("InternetCtrl",["$scope","$state","Transaction","$modal","STRIPE_KEY",function(a,b,c,d,e){"app.internet.choose"!==b.current.name&&b.transitionTo("app.internet.choose"),a.details={recipient:{},accountNumber:"",preferredContactMethod:"MAIL"},a.details.serviceFee=0,a.chooseState=!0,a.errors=[],a.paymentSaveSuccess=!0;var f=function(a){return Math.ceil(100*a)/100},g=function(){return a.errors=[],"SRF"!==a.details.billType&&"VOB"!==a.details.billType?(a.errors.push("Please select an Internet service provider"),!1):isNaN(a.details.amountGhs)||parseInt(a.details.amountGhs)<50||parseInt(a.details.amountGhs>5e3)?(a.errors.push("Amount can only be more than GHS 50 and less than GHS 5000"),!1):!0},h=function(){return a.errors=[],!a.details.recipient.phoneNumber||a.details.recipient.phoneNumber.length<10?(a.errors.push("Please enter a valid phone number"),!1):!0};a.reSavePayment=function(){if(!a.paymentSaveSuccess){var b={stripeToken:a.stripeToken.id,transactionId:a.details.transactionId,type:"BILL"};c.savePayment(b).then(function(){a.paymentSaveSuccess=!0,d.open({templateUrl:"apps/transaction/views/successModal.html",controller:"ModalCtrl"})},function(){a.paymentSaveSuccess=!1})}},c.getPricing().then(function(b){a.pricing=b},function(){}),c.getReferral().then(function(b){a.referral=b},function(){}),a.calculatePricing=function(){a.details.amountUsd=f(a.details.amountGhs/a.pricing.usdGhs),a.details.serviceFee=f(a.pricing.percentualFee*a.details.amountUsd+a.pricing.fixedFee),a.details.chargeUsd=f(a.details.amountUsd+a.details.serviceFee)},a.setDetails=function(){g()&&(a.recipientState=!0,b.transitionTo("app.internet.recipient"))},a.addRecipient=function(){h()&&(a.paymentState=!0,c.addBill(a.details).then(function(c){a.details.transactionId=c.transactionId,b.transitionTo("app.internet.payment")},function(a){a.detail&&"2"==a.detail&&d.open({templateUrl:"apps/transaction/views/incompleteProfileModal.html",controller:"ModalCtrl"})}))},a.getProvider=function(){return"SRF"===a.details.billType?"Surfline":"Vodafone"},a.confirm=function(){if(a.pricing){var b=StripeCheckout.configure({key:e,image:"/icon-128.png",token:function(b){a.stripeToken=b;var e={stripeToken:b.id,transactionId:a.details.transactionId,type:"BILL"};c.savePayment(e).then(function(){a.paymentSaveSuccess=!0,d.open({templateUrl:"apps/transaction/views/successModal.html",controller:"ModalCtrl"})},function(){a.paymentSaveSuccess=!1})}});b.open({name:"BeamPay",description:"GHS "+a.details.amountGhs+" on "+a.getProvider(),amount:100*a.details.chargeUsd})}return!1}}]),angular.module("app.school",[]).config(["$stateProvider",function(a){var b="apps/school/views/";a.state("app.school",{url:"^/school",templateUrl:b+"layouts/school.html"}).state("app.school.details",{url:"/details",templateUrl:b+"details.html",data:{pageTitle:"Choose Service"}}).state("app.school.contact",{url:"/contact",templateUrl:b+"contact.html",data:{pageTitle:"contact Details"}}).state("app.school.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Confirm Request"}})}]),angular.module("app.school").controller("SchoolCtrl",["$scope","$state","$modal","Transaction",function(a,b,c,d){"app.school.details"!==b.current.name&&b.transitionTo("app.school.details"),a.details={wardName:{},recipient:{},preferredContactMethod:"MAIL"},a.details.serviceFee=0,a.detailsState=!0,a.errors=[],a.paymentSaveSuccess=!0;var e=function(a){return Math.ceil(100*a)/100};d.getPricing().then(function(b){a.pricing=b},function(){}),a.calculatePricing=function(){a.details.amountUsd=e(a.details.amountGhs/a.pricing.usdGhs),a.details.serviceFee=e(a.pricing.percentualFee*a.details.amountUsd+a.pricing.fixedFee),a.details.chargeUsd=e(a.details.amountUsd+a.details.serviceFee)},a.setDetails=function(){a.contactState=!0,b.transitionTo("app.school.contact")},a.setMethod=function(){a.recipientState=!0,b.transitionTo("app.school.recipient")},a.makeTransaction=function(){a.details.wardName=a.details.wardName.firstName+" "+a.details.wardName.middleName+" "+a.details.wardName.lastName,d.addSchool(a.details).then(function(b){a.details.transactionId=b.transactionId,c.open({templateUrl:"apps/transaction/views/successModal.html",controller:"ModalCtrl"})},function(a){a.detail&&"2"==a.detail&&c.open({templateUrl:"apps/transaction/views/incompleteProfileModal.html",controller:"ModalCtrl"})})}}]),angular.module("app.valet",[]).config(["$stateProvider",function(a){var b="apps/valet/views/";a.state("app.valet",{url:"^/valet",templateUrl:b+"layouts/valet.html"}).state("app.valet.details",{url:"/details",templateUrl:b+"details.html",data:{pageTitle:"Valet Details"}}).state("app.valet.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}})}]),angular.module("app.valet").controller("ValetCtrl",["$scope","$state","$modal","Transaction",function(a,b,c,d){"app.valet.details"!==b.current.name&&b.transitionTo("app.valet.details"),a.details={recipient:{}},a.details.serviceFee=0,a.detailsState=!0,a.errors=[],a.paymentSaveSuccess=!0,a.setDetails=function(){a.recipientState=!0,b.transitionTo("app.valet.recipient")},a.makeTransaction=function(){d.addValet(a.details).then(function(b){a.details.transactionId=b.transactionId,c.open({templateUrl:"apps/transaction/views/successModal.html",controller:"ModalCtrl"})},function(a){a.detail&&"2"==a.detail&&c.open({templateUrl:"apps/transaction/views/incompleteProfileModal.html",controller:"ModalCtrl"})})}}]),angular.module("app.gift",[]).config(["$stateProvider",function(a){var b="apps/gift/views/";a.state("app.gift",{url:"^/gift",templateUrl:b+"layouts/gift.html"}).state("app.gift.details",{url:"/details",templateUrl:b+"details.html",data:{pageTitle:"Gift Details"}}).state("app.gift.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}})}]),angular.module("app.gift").controller("GiftCtrl",["$scope","$state","$modal","Transaction",function(a,b,c,d){"app.gift.details"!==b.current.name&&b.transitionTo("app.gift.details"),a.details={recipient:{}},a.details.serviceFee=0,a.detailsState=!0,a.errors=[],a.paymentSaveSuccess=!0,a.setDetails=function(){a.recipientState=!0,b.transitionTo("app.gift.recipient")},a.beforeRender=function(a,b){for(var c=new Date,d=0;d<b.length;d++)b[d].localDateValue()<c&&(b[d].selectable=!1)},a.makeTransaction=function(){d.addGift(a.details).then(function(b){a.details.transactionId=b.transactionId,c.open({templateUrl:"apps/transaction/views/successModal.html",controller:"ModalCtrl"})},function(a){a.detail&&"2"==a.detail&&c.open({templateUrl:"apps/transaction/views/incompleteProfileModal.html",controller:"ModalCtrl"})})}}]);