"use strict";angular.module("app",["angulartics","angulartics.google.analytics","angulartics.mixpanel","angulartics.scroll","ngCookies","ngResource","ui.router","ngSanitize","ngTouch","ngAnimate","ui.bootstrap","ui.bootstrap.datetimepicker","angular-ladda","angularMoment","angular-loading-bar","angular-intro","app.config","app.constants","app.interceptors","app.directives","app.utils","app.general","app.auth","app.transaction","app.settings","app.airtime","app.television","app.utility","app.internet","app.school","app.valet","app.gift"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","laddaProvider",function(a,b,c,d){c.hashPrefix("!"),a.state("app",{url:"/",templateUrl:"apps/transaction/views/layouts/transaction.html",data:{pageTitle:"Welcome"}}),b.otherwise("/home"),d.setOption({style:"zoom-out"})}]).run(["$rootScope","$anchorScroll","Auth","$state",function(a,b,c,d){a.$on("$stateChangeSuccess",function(e,f){angular.isDefined(f.data.pageTitle)&&(angular.isDefined(f.data.pageSubtitle)?a.pageTitle=f.data.pageSubtitle+" :: "+f.data.pageTitle+" | BeamPay":a.pageTitle=f.data.pageTitle+" | BeamPay");for(var g=["signin","signup","activate","confirmEmail","forgot","signupComplete","landing","hiw","about","resetPassword"],h=!0,i=0;i<g.length;i++)f.name===g[i]&&(h=!1);h&&!c.isLoggedIn()&&d.transitionTo("signup",{next:d.current.name}),b()}),(new WOW).init()}]),angular.module("app.config",[]).constant("name","production").constant("API_SERVER","https://api.beampay.co/api/v1/").constant("ROOT_URL","https://www.beampay.co/").constant("FACEBOOK_CLIENT_ID",0x58d04544d9171).constant("STRIPE_KEY","pk_live_7A6fR5AipZB3OgEuLfiivAUw"),angular.module("app").controller("HeaderCtrl",["$scope","$state","$modal","Auth","Persist",function(a,b,c,d,e){d.isLoggedIn()?a.loggedin=!0:a.loggedin=!1,a.logoutInProgress=!1,a.logout=function(){a.logoutInProgress=!0,d.signout().then(function(){a.logoutInProgress=!1,a.loggedin=!1,b.transitionTo("landing")})},a.signup=function(){b.transitionTo("signup")},a.signin=function(){b.transitionTo("signin")},a.dashboard=function(){b.transitionTo("app")},a.currentUser=e.getUser(),a.referralModal=function(){c.open({templateUrl:"apps/settings/views/referralModal.html",controller:"ReferralModalCtrl",resolve:{referralCode:function(){return a.referralCode}}})}}]),angular.module("app").controller("FooterCtrl",["$scope","$state",function(a,b){"landing"===b.current.name?(a.landing=!1,a.about=!0):(a.landing=!0,a.about=!1)}]),angular.module("app.utils",[]).service("Persist",["$window","$cookieStore",function(a,b){var c="userid",d="token",e="email",f="firstName",g="lastName",h="complete",i="referralCode",j="pricing",k=function(a,e,f){b.put(c,a),b.put(d,e),b.put(h,f)},l=function(a,c){b.put(f,a),b.put(g,c)},m=function(){b.remove(c),b.remove(d),b.remove(e),b.remove(f),b.remove(g),b.remove(h)},n=function(){var a="B.P.";return b.get(f)&&b.get(g)&&(a=b.get(f).substring(0,1)+"."+b.get(g).substring(0,1)+"."),{userid:b.get(c),token:b.get(d),firstName:b.get(f),lastName:b.get(g),complete:b.get(h),initials:a,referralCode:b.get(i)}},o=function(){return b.put(h,!0),!0},p=function(a){return b.put(i,a),!0},q=function(a){return b.put(e,a),!0},r=function(){return b.get(e)},s=function(a){b.put(j,JSON.stringify(a))},t=function(){return JSON.parse(b.get(j))};return{saveUser:function(a,b,c){return k(a,b,c)},saveUserName:function(a,b){return l(a,b)},getUser:function(){return n()},deleteUser:function(){return m()},completeUser:function(){return o()},saveEmail:function(a){return q(a)},getEmail:function(){return r()},savePricing:function(a){return s(a)},getPricing:function(){return t()},setReferralCode:function(a){return p(a)}}}]),angular.module("app.constants",[]).constant("ErrorConstants",{unknownError:"Oops! Something seems to have gone wrong.",unsupportedCountry:"Your country is not supported. We'll let you know when we support it",weakPassword:"The password must be at least 8 characters long and contain at least one numeric digit.",emailInUse:"An account with this email has already been created. Please login if you are the owner of this email. Else enter another email.",unactivatedEmail:"An activation link has been sent to your email. Please check your email for the next steps.",unmatchingPasswords:"The two passwords do not match",privacyUnaccepted:"Plese accept the Privacy Policy to continue",disabledAccount:"Sorry, your account has been disabled",invalidLoginCredentials:"Your email or password is incorrect. Please check and try again",emailOrPassEmpty:"Please enter both email and password",adimnLogin:"Admin accounts not allowed",fbUnknownError:"Oops! Something seems to have gone wrong with your signup. No worries, you can still signup using your Email",unverifiedFbAccount:"Oops! Your facebook account is not confirmed. Please confirm your facebook account and try again. Or sign up using your email.",fbPermissionRejected:"We could not retrieve your email address. Please use sign up with email or allow us to acces your email via Facebook.",invalidActivationKey:"The activation link you used was invalid. Please check and try again",expiredActivationKey:"The activation link you used has expired. Please try signing up again",unrecognizedEmail:"Sorry, this email is not recognized. Are you trying to signup? Please click on the signup link on the header.",activatedEmail:"You account has already been activated. Please try loggin in instead",invalidEmail:"Please enter a valid email",emailExists:"An account with this email has already been created. Please login if you are the owner of this email. Else enter another email.",unchangedEmail:"Your email has not been changed",incorrectPassword:"Sorry, your old Password is incorrect",unsetPassword:"Passwords not set",invalidParameters:"Some of the information you provided is incorrect. Please check and try again.",exchangeRateChanged:"The international exchange rate has changed. Please choose your service again.",incompleteProfile:"Your profile is incomplete please update your details in your settings",invalidReferral:"You have entered an invalid referral code. Please try again",setPassword:"A password has already been set. If you cannot remember please logout and send a reset password to your email."}),angular.module("app.utils").service("Error",["$modal","ErrorConstants",function(a,b){var c=function(b){a.open({templateUrl:"apps/common/views/modals/appRedirectModal.html",controller:"AppRedirectModalCtrl",resolve:{message:function(){return b}}})},d=function(b){a.open({templateUrl:"apps/common/views/modals/dismissModal.html",controller:"DismissModalCtrl",resolve:{message:function(){return b}}})},e=function(){a.open({templateUrl:"apps/transaction/views/incompleteProfileModal.html",controller:"IncompleteModalCtrl"})},f=function(a){var c={};return a?a.password1&&"1"===a.password1[0]?c.pass=b.weakPassword:a.email&&"4"===a.email[0]?c.email=b.emailInUse:a.email&&"5"===a.email[0]?c.top=b.unactivatedEmail:a.nonFieldErrors&&"2"===a.nonFieldErrors[0]?c.passMatch=b.unmatchingPasswords:a.acceptedPrivacyPolicy&&"3"===a.acceptedPrivacyPolicy[0]?c.privacy=b.privacyUnaccepted:c.top=b.unknownError:c.top=b.unknownError,c},g=function(a){var c={};return a.nonFieldErrors&&("11"===a.nonFieldErrors[0]?c.top=b.disabledAccount:"13"===a.nonFieldErrors[0]?c.top=b.invalidLoginCredentials:"0"===a.nonFieldErrors[0]?c.top=b.emailOrPassEmpty:"14"===a.nonFieldErrors[0]?c.top=b.adimnLogin:"12"===a.nonFieldErrors[0]&&(c.email=b.unactivatedEmail)),c},h=function(a){var c={};return a?a.detail&&"11"===a.detail?c.fbTop=b.disabledAccount:a.detail&&"18"===a.detail?c.fbTop=b.unverifiedFbAccount:a.detail&&"19"===a.detail&&(c.fbTop=b.fbPermissionRejected):c.fbTop=b.fbUnknownError,c},i=function(a){var c={};return a?"6"===a.detail?c.top=b.invalidActivationKey:"7"===a.detail&&(c.top=b.expiredActivationKey):c.top=b.unknownError,c},j=function(a){var c={};return a?"9"===a.detail?c.top=b.unrecognizedEmail:"10"===a.detail?c.top=b.activatedEmail:"11"===a.detail&&(c.top=b.disabledAccount):c.top=b.unknownError,c},k=function(a){var c={};return a?"0"===a.detail?c.email=b.invalidEmail:"4"===a.detail?c.email=b.emailInUse:"15"===a.detail&&(c.top=b.unchangedEmail):c.top=b.unknownError,c},l=function(a){var c={};return a?"0"===a.detail&&(c.top=b.invalidEmail):c.top=b.unknownError,c},m=function(){var a={};return a.top=b.unknownError,a},n=function(a){var c={};return a?a.oldPassword&&"16"===a.oldPassword[0]?c.oldPass=b.incorrectPassword:a.password1&&"1"===a.password1[0]?c.newPass=b.weakPassword:a.nonFieldErrors&&"2"===a.nonFieldErrors[0]?c.passMatch=b.unmatchingPasswords:a.detail&&"20"===a.detail&&(c.top=b.unsetPassword):c.top=b.unknownError,c},o=function(a){var c={};return a.detail&&"0"===a.detail?c.top=b.invalidParameters:a.password1&&"1"===a.password1[0]?c.pass=b.weakPassword:a.nonFieldErrors&&"2"===a.nonFieldErrors[0]?c.passMatch=b.unmatchingPasswords:a.detail&&"21"===a.detail&&(c.top=b.setPassword),c},p=function(a){var c={};return a?a.detail&&"9"===a.detail?c.email=b.unrecognizedEmail:a.detail&&"11"===a.detail?c.top=b.disabledAccount:a.detail&&"12"===a.detail&&(c.top=b.unactivatedEmail):c.top=b.unknownError,c},q=function(a,d){var f={};return 451===d?(c(b.unsupportedCountry),f.top=b.unsupportedCountry):a.detail&&"0"===a.detail?f.top=b.invalidParameters:a.detail&&"1"===a.detail?(c(b.exchangeRateChanged),f.top=b.exchangeRateChanged):a.detail&&"2"===a.detail?(e(),f.top=b.incompleteProfile):(c(b.unknownError),f.top=b.unknownError),f},r=function(a,d){var e={};404===d?(c(b.unknownError),e.top=b.unknownError):(c(b.unknownError),e.top=b.unknownError)},s=function(a,e){var f={};a?"0"===a.detail?(c(b.unknownError),f.top=b.unknownError):"2"===a.detail?(d("Sorry, your credit card was rejected. The reason is: "+a.message+". Please reach out to hello@beampay.co for assistance"),f.top=a.message):e>299&&(c(b.unknownError),f.top=b.unknownError):(c(b.unknownError),f.top=b.unknownError)},t=function(a){var c={};return"0"===a.detail?c.referralCode=b.invalidParameters:"2"===a.detail&&(c.referralCode=b.invalidReferral),c};return{signup:function(a){return f(a)},signIn:function(a){return g(a)},signInFb:function(a){return h(a)},activate:function(a){return i(a)},activateResend:function(a){return j(a)},changeEmail:function(a){return k(a)},confirmEmail:function(a){return l(a)},isPassword:function(a){return m(a)},changePassword:function(a){return n(a)},setPassword:function(a){return o(a)},forgot:function(a){return p(a)},transaction:function(a,b){return q(a,b)},payment:function(a,b){return s(a,b)},pricing:function(a,b){return r(a,b)},setReferral:function(a){return t(a)},incompleteModal:function(){return e()}}}]),angular.module("app.utils").controller("DismissModalCtrl",["$scope","$modalInstance","message",function(a,b,c){a.message=c,a.cancel=function(){b.dismiss()}}]).controller("AppRedirectModalCtrl",["$scope","$modalInstance","$state","message",function(a,b,c,d){a.message=d,b.result.then(function(){},function(){c.transitionTo("app")}),a.cancel=function(){b.dismiss()}}]),angular.module("app.utils").config(["$provide",function(a){a.decorator("$exceptionHandler",["$delegate",function(a){return function(b,c){a(b,c),Raven&&Raven.captureException(b)}}])}]),angular.module("app.utils").filter("truncate",function(){return function(a,b,c,d){if(!a)return"";if(c=parseInt(c,10),c||(c=70),a.length<=c)return a;if(a=a.substr(0,c),!b){var e=a.lastIndexOf(" ");-1!==e&&(a=a.substr(0,e))}return a+(d||" â€¦")}}),angular.module("app.interceptors",[]).service("AuthInterceptor",["$q","$location","Persist","API_SERVER",function(a,b,c,d){var e=function(a){var b=new RegExp("^"+d);if(a.url.match(b)){a.headers=a.headers||{};var e=c.getUser();e&&e.token&&(a.headers.Authorization="Token "+e.token)}return a},f=function(d){if(401===d.status)c.deleteUser(),b.path(b.path());else if(Raven){var e={};$.extend(e,d);try{delete e.config.data.password,delete e.config.data.password1,delete e.config.data.password2}catch(f){}try{delete e.headers.Authorization,delete e.data.token}catch(f){}try{delete e.config.headers.Authorization}catch(f){}Raven.captureException(JSON.stringify(e))}return a.reject(d)};return{request:function(a){return e(a)},responseError:function(a){return f(a)}}}]),angular.module("app.directives",[]).directive("stopEvent",function(){return{restrict:"A",link:function(a,b,c){b.on(c.stopEvent,function(a){a.stopPropagation()})}}}),angular.module("app.general",[]).config(["$stateProvider",function(a){var b="apps/general/views/";a.state("landing",{url:"/home",templateUrl:b+"landing/landing.html",data:{pageTitle:"Beam - Care for loved ones in Ghana quickly and affordably"}}).state("hiw",{url:"/how",templateUrl:b+"hiw/hiw.html",data:{pageTitle:"How it works"}}).state("about",{url:"/about",templateUrl:b+"about/about.html",data:{pageTitle:"About BeamPay"}})}]),angular.module("app.general").controller("NotifyCtrl",["$scope","$modal","ROOT_URL","FACEBOOK_CLIENT_ID",function(a,b,c,d){a.baseUrl=c,a.appId=d,a.open=function(){b.open({templateUrl:"apps/general/views/landing/modals/_email.html",controller:"ModalCtrl"})}}]),angular.module("app.general").controller("ModalCtrl",["$scope","$modalInstance","Modal","$state",function(a,b,c,d){a.ok=function(){a.fromName&&a.fromEmail&&a.toName&&a.toEmail&&(a.loading=!0,c.sendEmail(a.fromName,a.fromEmail,a.toName,a.toEmail).then(function(){a.loading=!1,b.close()},function(b){a.loading=!1,a.err=b}))},a.cancel=function(){b.dismiss(),d.transitionTo("landing")}}]),angular.module("app.general").service("Modal",["$http","$q","API_SERVER",function(a,b,c){var d=function(d,e,f,g){var h=c+"share_mail/",i=b.defer();return a.post(h,{fromName:d,fromEmail:e,toName:f,toEmail:g}).success(function(){i.resolve()}).error(function(a){i.reject(a)}),i.promise};return{sendEmail:function(a,b,c,e){return d(a,b,c,e)}}}]),angular.module("app.auth",["satellizer"]).config(["$stateProvider","$httpProvider","$authProvider","API_SERVER","FACEBOOK_CLIENT_ID",function(a,b,c,d,e){var f="/auth/",g="apps/auth/views/";a.state("signupComplete",{url:f+"signup/complete",templateUrl:g+"signupComplete.html",data:{pageTitle:"Signup Complete"}}).state("signup",{url:f+"signup/?next&referralCode",templateUrl:g+"signup.html",data:{pageTitle:"Signup"}}).state("signin",{url:f+"signin/?next",templateUrl:g+"signin.html",data:{pageTitle:"Signin"}}).state("facebookredirect",{url:f+"facebook-redirect",templateUrl:g+"facebookRedirect.html",data:{pageTitle:"Loggin In"}}).state("activate",{url:f+"activate/:key/",templateUrl:g+"activate.html",data:{pageTitle:"Activate"}}).state("settings",{url:f+"settings",templateUrl:g+"settings.html",data:{pageTitle:"Settings"}}).state("settings.email",{url:f+"settings/email",templateUrl:g+"changeEmail.html",data:{pageTitle:"Email Settings"}}).state("settings.password",{url:f+"settings/password",templateUrl:g+"password.html",data:{pageTitle:"Password Settings"}}).state("forgot",{url:f+"forgot",templateUrl:g+"forgot.html",data:{pageTitle:"Forgot Password"}}).state("resetPassword",{url:f+"forgot/:key/",templateUrl:g+"resetPassword.html",data:{pageTitle:"Reset Password"}}),b.interceptors.push("AuthInterceptor"),c.baseUrl=d,c.loginRedirect="/auth/facebook-redirect",c.facebook({clientId:e,url:"account/signin/facebook/"})}]),angular.module("app.auth").controller("SignupCtrl",["$scope","$state","$stateParams","$auth","$location","Auth","Referral","Error",function(a,b,c,d,e,f,g,h){f.isLoggedIn()&&b.transitionTo("app"),a.stateParams=c,a.signup={privacy:!0},a.signup.referralCode=c.referralCode,a.signup.submit=function(){a.signup.errors={};var c=a.signup.email,d=a.signup.pass1,e=a.signup.pass2,g=a.signup.privacy;return c?d?g?d!==e?void(a.signup.errors.passMatch="Passwords don't match"):(a.laddaSignup=!0,void f.signup(a.signup).then(function(){a.laddaSignup=!1,b.transitionTo("signupComplete")},function(b){a.laddaSignup=!1,a.signup.errors=h.signup(b.data)})):void(a.signup.errors.privacy="Please accept the Terms and Conditions"):void(a.signup.errors.pass="Password is required"):void(a.signup.errors.email="Email is required")},a.signup.fb=function(){a.laddaFbSignup=!0,d.authenticate("facebook",{acceptedPrivacyPolicy:!0}).then(function(d){a.laddaFbSignup=!1,f.persist(d.data.id,d.data.token,d.data.complete),f.saveName(d.data.firstName,d.data.lastName),c.referralCode&&g.setReferral(c.referralCode),d.data.complete?c.next?e.path(b.href(c.next).slice(2)):e.path(b.href("app").slice(2)):e.path(b.href("onboard.name").slice(2))},function(b){a.laddaFbSignup=!1,a.signup.errors=h.signInFb(b.data)})},$(".show-email").click(function(){$("#sign-form").slideToggle()})}]),angular.module("app.auth").controller("SignInCtrl",["$scope","$state","$stateParams","$window","$auth","$location","Auth","Error",function(a,b,c,d,e,f,g,h){g.isLoggedIn()&&b.transitionTo("app"),a.signIn={},a.signIn.submit=function(){a.signIn.errors={};var d=a.signIn.email,e=a.signIn.pass;return d?e?(a.laddaLogin=!0,void g.signIn(d,e).then(function(d){if(a.laddaLogin=!1,d){var e=c.next;e?b.transitionTo(e):b.transitionTo("app")}else b.transitionTo("onboard.name")},function(b){a.laddaLogin=!1,a.signIn.errors=h.signIn(b.data)})):void(a.signIn.errors.pass="Password is required"):void(a.signIn.errors.email="Email is required")},a.signIn.fb=function(){a.laddaFbLogin=!0,e.authenticate("facebook",{acceptedPrivacyPolicy:!0}).then(function(d){a.laddaFbLogin=!1,g.persist(d.data.id,d.data.token,d.data.complete),g.saveName(d.data.firstName,d.data.lastName),d.data.complete?c.next?f.path(b.href(c.next).slice(2)):f.path(b.href("app").slice(2)):f.path(b.href("onboard.name").slice(2))},function(b){a.laddaFbLogin=!1,a.signIn.errors=h.signInFb(b.data)})},a.forgot=function(){b.transitionTo("forgot")},$(".show-email").click(function(){$("#sign-form").slideToggle()})}]),angular.module("app.auth").controller("SignoutCtrl",["$scope","$state","Auth",function(a,b,c){a.signout=function(){c.signout().then(function(){b.transitionTo("landing")},function(){b.transitionTo("landing")})}}]),angular.module("app.auth").controller("ActivateCtrl",["$scope","$state","$stateParams","Auth","Error",function(a,b,c,d,e){a.activate={};var f=c.key;f?d.activate(f).then(function(){b.transitionTo("onboard.name")},function(b){a.activate.errors=e.activate(b),a.activate.errorData=b}):b.transitionTo("landing")}]),angular.module("app.auth").controller("ActivateResendCtrl",["$state","$scope","Auth","Error","Persist",function(a,b,c,d,e){e.getEmail()||a.transitionTo("signin"),b.user={email:e.getEmail()},b.activateResend={},b.activateResend.submit=function(){b.laddaActivate=!0,c.activateResend().then(function(){b.activateResend.success=!0,b.laddaActivate=!1},function(a){b.laddaActivate=!1,b.activateResend.errors=d.activateResend(a)})}}]),angular.module("app.auth").controller("ChangeEmailCtrl",["$scope","Settings","Error",function(a,b,c){a.changeEmail={},a.changeEmail.submit=function(){a.changeEmail.errors={};var d=a.changeEmail.email;return d?void b.changeEmail(d).then(function(){a.changeEmail.success=!0},function(b){a.changeEmail.errors=c.changeEmail(b)}):void(a.changeEmail.errors.email="Email required")}}]),angular.module("app.auth").controller("ConfirmEmailCtrl",["$scope","$state","$stateParams","Settings","Error",function(a,b,c,d,e){a.confirmEmail={};var f=c.key;f?d.confirmEmail(f).then(function(){a.confirmEmail.success=!0},function(b){a.confirmEmail.errors=e.confirmEmail(b)}):b.transitionTo("landing")}]),angular.module("app.auth").controller("PasswordCtrl",["$scope","Settings","Error",function(a,b,c){a.password={},b.isPassword().then(function(b){b?a.password.passwordExists=!0:a.password.passwordNoExists=!0},function(a){c.isPassword(a)}),a.changePassword={},a.changePassword.submit=function(){a.changePassword.errors=[];var d=a.changePassword.oldPass,e=a.changePassword.pass1,f=a.changePassword.pass2;return d&&e&&f?e!==f?void a.changePassword.errors.push("New passwords don't match"):void b.changePassword(d,e,f).then(function(){a.changePassword.success=!0},function(b){a.changePassword.errors=c.changePassword(b)}):void a.changePassword.errors.push("All fields required")},a.setPassword={},a.setPassword.submit=function(){a.setPassword.errors=[];var d=a.setPassword.pass1,e=a.setPassword.pass2;return d&&e?d!==e?void a.setPassword.errors.push("Passwords don't match"):void b.setPassword(d,e).then(function(){a.setPassword.success=!0},function(b){a.setPassword.errors=c.setPassword(b)}):void a.setPassword.errors.push("All fields required")}}]),angular.module("app.auth").controller("ForgotCtrl",["$scope","Settings","Error",function(a,b,c){a.forgot={},a.forgot.submit=function(){a.forgot.errors={};var d=a.forgot.email;return d?(a.laddaForgot=!0,void b.requestResetPassword(d).then(function(){a.forgot.email=d,a.forgot.success=!0,a.laddaForgot=!1},function(b){a.laddaForgot=!1,a.forgot.errors=c.forgot(b)})):void(a.forgot.errors.email="Email required")}}]),angular.module("app.auth").controller("ResetPasswordCtrl",["$scope","$state","$stateParams","Settings","Error",function(a,b,c,d,e){var f=c.key;f?(a.resetPassword={},d.showResetPassword(f).then(function(){a.resetPassword.can=!0},function(){a.resetPassword.cannot=!0}),a.resetPassword.submit=function(){a.resetPassword.errors=[];var b=a.resetPassword.pass1,c=a.resetPassword.pass2;return b&&c?b!==c?void a.resetPassword.errors.push("Passwords don't match"):(a.laddaPass=!0,void d.resetPassword(f,b,c).then(function(){a.resetPassword.success=!0,a.laddaPass=!1},function(b){a.resetPassword.errors=e.resetPassword(b),a.laddaPass=!1})):void a.resetPassword.errors.push("All fields required")}):b.transitionTo("landing")}]),angular.module("app.auth").controller("FacebookCtrl",["$state","Persist",function(a,b){b.getUser().complete?a.transitionTo("app"):a.transitionTo("onboard.name")}]),angular.module("app.auth").service("Auth",["$cookieStore","$http","$q","Persist","API_SERVER",function(a,b,c,d,e){e+="account/";var f=function(a,b,c){d.saveUser(a,b,c)},g=function(a,b){d.saveUserName(a,b)},h=function(a){var f=e+"signup/",g=c.defer();return d.deleteUser(),b.post(f,{email:a.email,password1:a.pass1,password2:a.pass2,acceptedPrivacyPolicy:a.privacy,referralCode:a.referralCode}).success(function(){d.saveEmail(a.email),g.resolve()}).error(function(a,b){g.reject({data:a,status:b})}),g.promise},i=function(a,h){var i=e+"signin/",j=c.defer();return d.deleteUser(),b.post(i,{email:a,password:h}).success(function(a){f(a.id,a.token,a.complete),a.complete&&g(a.firstName,a.lastName),j.resolve(a.complete)}).error(function(a,b){j.reject({data:a,status:b})}),j.promise},j=function(){var a=e+"signout/",f=c.defer();return b.post(a).success(function(){d.deleteUser(),f.resolve()}).error(function(a){f.reject(a)}),f.promise},k=function(a){var d=e+"activate/"+a+"/",g=c.defer();return b.get(d).success(function(a){f(a.id,a.token,!1),g.resolve()}).error(function(a){g.reject(a)}),g.promise},l=function(){var a=e+"activate/resend/",f=c.defer();return b.post(a,{email:d.getEmail()}).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise},m=function(){return d.getUser().userid?!0:!1};return{persist:function(a,b,c){return f(a,b,c)},saveName:function(a,b){return g(a,b)},signup:function(a){return h(a)},signIn:function(a,b){return i(a,b)},signout:function(){return j()},activate:function(a){return k(a)},activateResend:function(a){return l(a)},isLoggedIn:function(){return m()}}}]),angular.module("app.auth").service("Settings",["$http","$q","Persist","API_SERVER",function(a,b,c,d){d+="account/";var e=function(c){var e=d+"email/",f=b.defer();return a.post(e,{email:c}).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise},f=function(c){var e=d+"confirm-email/"+c+"/",f=b.defer();return a.get(e).success(function(){f.resolve()}).error(function(a){console.log(a),f.reject(a)}),f.promise},g=function(){var c=d+"password/set/",e=b.defer();return a.get(c).success(function(a){e.resolve(a.passwordSet)}).error(function(a){e.reject(a)}),e.promise},h=function(e,f,g){var h=d+"password/",i=b.defer();return a.post(h,{oldPassword:e,password1:f,password2:g}).success(function(a){var b=c.getUser().userid;c.saveUser(b,a.token),i.resolve()}).error(function(a){i.reject(a)}),i.promise},i=function(c,e){var f=d+"password/set/",g=b.defer();return a.post(f,{password1:c,password2:e}).success(function(){g.resolve()}).error(function(a){g.reject(a)}),g.promise},j=function(c){var e=d+"password/reset/",f=b.defer();return a.post(e,{email:c}).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise},k=function(c){var e=d+"password/reset/confirm/"+c+"/",f=b.defer();return a.get(e).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise},l=function(c,e,f){var g=d+"password/reset/confirm/"+c+"/",h=b.defer();return a.post(g,{password1:e,password2:f}).success(function(){h.resolve()}).error(function(a){h.reject(a)}),h.promise};return{changeEmail:function(a){return e(a)},confirmEmail:function(a){return f(a)},changePassword:function(a,b,c){return h(a,b,c)},isPassword:function(a){return g(a)},setPassword:function(a,b){return i(a,b)},requestResetPassword:function(a){return j(a)},showResetPassword:function(a){return k(a)},resetPassword:function(a,b,c){return l(a,b,c)}}}]),angular.module("app.settings",[]).config(["$stateProvider",function(a){var b="apps/settings/views/";a.state("onboard",{url:"/settings/onboard","abstract":"true",template:"<ui-view/>"}).state("onboard.name",{url:"/name",templateUrl:b+"onboardName.html",data:{pageTitle:"Onboarding - Name"}}).state("onboard.address",{url:"/address",templateUrl:b+"onboardAddress.html",data:{pageTitle:"Onboarding - Address"}})}]),angular.module("app.settings").controller("OnboardNameCtrl",["$scope","$state","Onboard","Error","Referral",function(a,b,c,d,e){a.settings={},c.getProfile().then(function(b){a.settings=b,a.settings.submit=f},function(){});var f=function(){a.settings.errors={};var f=a.settings.firstName,g=a.settings.lastName;if(!f)return void(a.settings.errors.firstName="First Name required");if(!g)return void(a.settings.errors.lastName="Last Name required");var h=function(){c.saveName(f,g).then(function(){a.laddaOnboard=!1,b.transitionTo("onboard.address")},function(){a.laddaOnboard=!1,a.settings.errors.push("Some of the information you provided is invalid. Please check and try again.")})};a.laddaOnboard=!0,a.settings.referralCode?e.setReferral(a.settings.referralCode).then(function(){h()},function(b){a.laddaOnboard=!1,b.detail&&"1"===b.detail?h():a.settings.errors=d.setReferral(b)}):h()}}]),angular.module("app.settings").controller("OnboardAddressCtrl",["$scope","$state","Onboard","Persist","SettingsUtil",function(a,b,c,d,e){a.whatsAppMethod="WAP",a.smsMethod="SMS",a.phoneMethod="PHON",a.emailMethod="MAIL",a.settings={date:{},preferredContactMethod:a.whatsAppMethod,preferredContactDetails:""},a.settings.country="US",a.settings.firstName=d.getUser().firstName,c.getProfile().then(function(b){a.settings=b.profile,a.settings.submit=f,a.settings.firstName=b.firstName,a.settings.lastName=b.lastName,a.settings.country="US";var c=new Date(a.settings.dateOfBirth);a.settings.date={year:c.getFullYear().toString(),month:(c.getMonth()+1).toString(),day:c.getDate().toString()},b.profile.dateOfBirth||(a.settings.date={year:"",month:"",day:""})},function(){});var f=function(){if(a.settings.errors={},a.settings.dateOfBirth=a.settings.date.year+"-"+a.settings.date.month+"-"+a.settings.date.day,!a.settings.date.day)return void(a.settings.errors.dateOfBirth="Please provide a day for date of birth");if(!a.settings.date.month)return void(a.settings.errors.dateOfBirth="Please provide a month for date of birth");if(!a.settings.date.year)return void(a.settings.errors.dateOfBirth="Please provide a year for date of birth");if(!a.settings.country)return void(a.settings.errors.country="Please select a country");if(!a.settings.phoneNumber)return void(a.settings.errors.phoneNumber="Please provide a valid phone number");if(!a.settings.street)return void(a.settings.errors.street="Please provide your street name.");if(!a.settings.city)return void(a.settings.errors.city="Please provide your city.");if(!a.settings.postCode)return void(a.settings.errors.postCode="Please provide your Postcode");if(a.settings.preferredContactDetails)a.laddaOnboard=!0,c.saveAddress(a.settings).then(function(){a.laddaOnboard=!1,b.transitionTo("app")},function(){a.laddaOnboard=!1,a.settings.errors.push("This page has errors")});else switch(a.settings.preferredContactMethod){case"WAP":a.settings.errors.preferredContactMethod="Please enter your WhatsApp number in the contact details field.";break;case"PHON":a.settings.errors.preferredContactMethod="Please enter your phone number in the contact details field.";break;case"SMS":a.settings.errors.preferredContactMethod="Please enter your SMS number in the contact details field.";break;case"MAIL":a.settings.errors.preferredContactMethod="Please enter your email in the contact details field."}};a.$watch("settings.preferredContactMethod",function(a){e.changePrefContactDetails(a)})}]),angular.module("app.settings").controller("ReferralModalCtrl",["$scope","$modalInstance","$state","referralCode","Referral","ROOT_URL","FACEBOOK_CLIENT_ID",function(a,b,c,d,e,f,g){a.baseUrl=f,a.appId=g,e.getReferral().then(function(b){a.referral=b},function(){}),a.cancel=function(){b.dismiss()}}]),angular.module("app.settings").service("Onboard",["$http","$q","API_SERVER","Persist",function(a,b,c,d){var e=function(e,f){var g=c+"account/profile/",h=b.defer();return a.put(g,{firstName:e,lastName:f}).success(function(){d.saveUserName(e,f),h.resolve()}).error(function(a){h.reject(a)}),h.promise},f=function(e){var f=c+"account/profile/",g=b.defer();return a.put(f,{profile:e}).success(function(){d.completeUser(),g.resolve()}).error(function(a){g.reject(a)}),g.promise},g=function(){var d=c+"account/profile/",e=b.defer();return a.get(d).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise};return{saveName:function(a,b){return e(a,b)},saveAddress:function(a){return f(a)},getProfile:function(){return g()}}}]),angular.module("app.settings").service("Referral",["$http","$q","API_SERVER","Persist",function(a,b,c,d){var e=function(){var e=c+"referral/",f=b.defer();return a.get(e).success(function(a){d.setReferralCode(a.code),f.resolve(a)}).error(function(a){f.reject(a)}),f.promise},f=function(d){var e=c+"referral/add/",f=b.defer();return a.post(e,{code:d}).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise};return{setReferral:function(a){return f(a)},getReferral:function(){return e()}}}]),angular.module("app.settings").service("SettingsUtil",function(){var a=function(a){"SMS"===a?($("#contact").attr("placeholder","Please enter your SMS no. e.g.: +233265086508"),$("#contact").attr("type","text")):"WAP"===a?($("#contact").attr("placeholder","Please enter your WhatsApp no. e.g.: +233265086508"),$("#contact").attr("type","text")):"PHON"===a&&($("#contact").attr("placeholder","Please enter your phone no. e.g.: +233265086508"),$("#contact").attr("type","text")),"MAIL"===a&&($("#contact").attr("placeholder","Please enter your email e.g.: email@domain.com"),$("#contact").attr("type","email"))};return{changePrefContactDetails:function(b){return a(b)}}}),angular.module("app.transaction",[]).config(["$stateProvider",function(a){var b="apps/transaction/views/";a.state("app.transaction",{url:"^/transactions",templateUrl:b+"layouts/transactions.html"}).state("app.transaction.list",{url:"/",templateUrl:b+"transactionsList.html"}).state("app.transaction.details",{url:"/:transactionId/:transactionType",templateUrl:b+"transactionDetails.html"})}]),angular.module("app.transaction").controller("HomeCtrl",["$scope","Persist",function(a,b){a.currentUser=b.getUser(),a.IntroOptions={steps:[{element:document.querySelector("#intro-gift"),intro:"Select a Gift to send"}],showStepNumbers:!1,showBullets:!1,exitOnOverlayClick:!0,exitOnEsc:!0,nextLabel:"Next",prevLabel:"Previous",doneLabel:"Thanks"}}]),angular.module("app.transaction").controller("TransactionDetailCtrl",["$scope","$stateParams","Transaction","TransactionUtil","Persist",function(a,b,c,d,e){
a.toCurr=function(a){return d.toCurr(parseFloat(a))},a.currentUser=e.getUser(),b.transactionId&&b.transactionType&&c.getTransaction(b.transactionId,b.transactionType).then(function(c){a.transaction=c,a.transactionType=b.transactionType},function(){}),a.getDescription=function(a){return d.getDescription(a)},a.getComment=function(b){return"INIT"===b?d.getDescription({transactionType:a.transactionType,data:a.transaction}):"INFO"===b?"We're gathering information about your transaction.":"REDY"===b?"We're ready to receive payment on your transaction.":"PAID"===b?"We've successfully confirmed payment for your transaction.":"PROC"===b?"We've successfully processed and completed the transaction you requested. Thank you for using BeamPay.":"CANC"===b?"Sorry, we could not complete this transaction.":"INVD"===b?"Sorry, we could not proceed with this transaction. Please contact us for further details. Thank you.":b}}]).controller("TransactionCtrl",["$scope","TransactionUtil","Transaction",function(a,b,c){a.transactions=[],a.getDescription=function(a){return b.getDescription(a)},a.getType=function(a){return b.getType(a)},c.getTransactions().then(function(b){a.transactions=b,a.$broadcast("dataloaded")},function(){})}]),angular.module("app.general").controller("IncompleteModalCtrl",["$scope","$modalInstance","$state",function(a,b,c){b.result.then(function(){},function(){c.transitionTo("onboard.name")}),a.cancel=function(){b.dismiss()}}]),angular.module("app.general").controller("SuccessModalCtrl",["$scope","$modalInstance","$state","referenceNumber","stateParams",function(a,b,c,d,e){a.referenceNumber=d,b.result.then(function(){},function(){c.transitionTo("app.transaction.details",e)}),a.cancel=function(){b.dismiss(),c.transitionTo("app.transaction.details",e)}}]),angular.module("app.transaction").service("Transaction",["$http","$q","API_SERVER","Persist",function(a,b,c,d){var e=function(d,e){var f=c+d,g=b.defer();return a.post(f,e).success(function(a){g.resolve(a)}).error(function(a,b){g.reject({data:a,status:b})}),g.promise},f=function(){var e=c+"pricing/",f=b.defer();return a.get(e).success(function(a){d.savePricing(a),f.resolve(a)}).error(function(a,b){f.reject({data:a,status:b})}),f.promise},g=function(d){var e=c+d,f=b.defer();return a.get(e).success(function(a){f.resolve(a)}).error(function(a){f.reject(a)}),f.promise},h=function(){return g("referral/")},i=function(){return g("transaction/")},j=function(a,b){return g("transaction/"+a+"/?type="+b)},k=function(){return g("account/profile/")},l=function(a){var b=d.getPricing();return a.exchangeRateId=b.exchangeRateId,a.serviceFeeId=b.airtime.serviceFeeId,e("transaction/add/airtime/",a)},m=function(a){var b=d.getPricing();return a.exchangeRateId=b.exchangeRateId,a.serviceFeeId=b.bill.serviceFeeId,e("transaction/add/bill/",a)},n=function(a){return e("transaction/add/valet/",a)},o=function(a){return e("transaction/add/gift/",a)},p=function(a){return e("transaction/add/school/",a)},q=function(a){return e("payment/stripe/",a)};return{addAirtime:function(a){return l(a)},addBill:function(a){return m(a)},addValet:function(a){return n(a)},addGift:function(a){return o(a)},addSchool:function(a){return p(a)},getPricing:function(){return f()},getReferral:function(){return h()},savePayment:function(a){return q(a)},getTransaction:function(a,b){return j(a,b)},getTransactions:function(){return i()},getProfile:function(){return k()}}}]),angular.module("app.transaction").service("TransactionUtil",["$q","STRIPE_KEY","$modal",function(a,b,c){var d=function(a){var b="";switch(a){case"DST":b="DStv";break;case"GOT":b="GOtv";break;case"ECG":b="Electricity";break;case"GWC":b="Water";break;case"SRF":b="Surfline";break;case"VOB":case"VOD":b="Vodafone";break;case"AIR":b="Airtel";break;case"MTN":b="MTN";break;case"TIG":b="Tigo";break;case"CAKE":b="Cake";break;case"FLOW":b="Flowers";break;case"BASK":b="Gift basket";break;case"MISC":b="Something Else"}return b},e=function(a){return"billpayment"===a.transactionType||"BILL"===a.transactionType?"GHS "+a.data.amountGhs+" billing on "+d(a.data.billType)+" for "+a.data.recipient.firstName+" "+a.data.recipient.lastName:"airtimetopup"===a.transactionType||"AIRTIME"===a.transactionType?"GHS "+a.data.amountGhs+" "+d(a.data.network)+" airtime for "+a.data.recipient.firstName+" "+a.data.recipient.lastName:"schoolfeepayment"===a.transactionType||"SCHOOL"===a.transactionType?a.data.wardName+" fees to "+a.data.school:"valettransaction"===a.transactionType||"VALET"===a.transactionType?a.data.description:"gift"===a.transactionType||"GIFT"===a.transactionType?"Send "+d(a.data.giftType)+" to "+a.data.recipient.firstName+" "+a.data.recipient.lastName:void 0},f=function(a){var b={};return a.recipient.firstName&&a.recipient.lastName||(b.name="Please enter first and last name of the recipient"),(!a.recipient.phoneNumber||a.recipient.phoneNumber.length<10)&&(b.phoneNumber="Please enter a valid phone number"),b},g=function(a){return"billpayment"===a.transactionType?"BILL":"airtimetopup"===a.transactionType?"AIRTIME":"schoolfeepayment"===a.transactionType?"SCHOOL":"valettransaction"===a.transactionType?"VALET":"gift"===a.transactionType?"GIFT":void 0},h=function(c,d){var e=a.defer(),f=StripeCheckout.configure({key:b,image:"/icon-128.png",token:function(a){e.resolve(a)}});return f.open({name:"BeamPay",description:c,amount:d,closed:function(){e.reject()}}),e.promise},i=function(a,b,d){c.open({templateUrl:"apps/transaction/views/successModal.html",controller:"SuccessModalCtrl",resolve:{referenceNumber:function(){return a},stateParams:function(){return{transactionId:b,transactionType:d}}}})},j=function(a){return Math.ceil(100*a)/100},k=function(a,b){var c=j(a/b.usdGhs),d=j(b.airtime.percentualFee*c+b.airtime.fixedFee),e=j(c+d);return{amountUsd:c,serviceFee:d,chargeUsd:e}},l=function(a,b){var c=j(a/b.usdGhs),d=j(b.bill.percentualFee*c+b.bill.fixedFee),e=j(c+d);return{amountUsd:c,serviceFee:d,chargeUsd:e}};return{getDescription:function(a){return e(a)},getFullName:function(a){return d(a)},getType:function(a){return g(a)},validateRecipient:function(a){return f(a)},makePayment:function(){return h()},successModal:function(a,b,c){return i(a,b,c)},toCurr:function(a){return j(a)},calculateAirtimePricing:function(a,b){return k(a,b)},calculateBillPricing:function(a,b){return l(a,b)}}}]),angular.module("app.television",[]).config(["$stateProvider",function(a){var b="apps/television/views/";a.state("app.television",{url:"^/television",templateUrl:b+"layouts/television.html"}).state("app.television.choose",{url:"/choose",templateUrl:b+"choose.html",data:{pageTitle:"Choose Service"}}).state("app.television.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}}).state("app.television.payment",{url:"/payment",templateUrl:b+"payment.html",data:{pageTitle:"Confirm Payment"}})}]),angular.module("app.television").controller("TelevisionCtrl",["$scope","$state","Transaction","TransactionUtil","Error",function(a,b,c,d,e){"app.television.choose"!==b.current.name&&b.transitionTo("app.television.choose");var f=function(){return a.errors={},a.details.billType!==a.dstvProvider&&a.details.billType!==a.gotvProvider?(a.errors.billType="Please select a TV service provider",!1):a.details.accountNumber&&(a.details.accountNumber.toString().length<8||isNaN(a.details.accountNumber))?(a.errors.accountNumber="The reference number has to be 8 digits long",!1):a.details.amountGhs?!0:(a.errors.amountGhs="Please enter the amount to pay in Ghana Cedis",!1)};a.details={recipient:{}},a.details.serviceFee=0,a.chooseState=!0,a.errors=[],a.paymentSaveSuccess=!0,a.transactionType="BILL",a.dstvProvider="DST",a.gotvProvider="GOT",c.getProfile().then(function(b){b.profile.informationComplete?a.email=b.email:e.incompleteModal()},function(){}),c.getPricing().then(function(b){a.pricing=b},function(b){a.errors=e.pricing(b.data,b.status)}),c.getReferral().then(function(b){a.referral=b},function(){}),a.reSavePayment=function(){if(!a.paymentSaveSuccess){var b={stripeToken:a.paymentToken.id,transactionId:a.details.transactionId,type:a.transactionType};c.savePayment(b).then(function(){a.paymentSaveSuccess=!0,d.successModal(a.details.referenceNumber,a.details.transactionId,a.transactionType)},function(b){a.paymentSaveSuccess=!1,a.errors=e.payment(b.data,b.status)})}},a.calculatePricing=function(){var b=d.calculateBillPricing(a.details.amountGhs,a.pricing);a.details.amountUsd=b.amountUsd,a.details.serviceFee=b.serviceFee,a.details.chargeUsd=b.chargeUsd},a.setDetails=function(){f()&&(a.recipientState=!0,b.transitionTo("app.television.recipient"))},a.addRecipient=function(){a.errors=d.validateRecipient(a.details),$.isEmptyObject(a.errors)&&(a.paymentState=!0,a.details.accountNumber||delete a.details.accountNumber,a.details.recipient.email||delete a.details.recipient.email,a.laddaAddTxn=!0,c.addBill(a.details).then(function(c){a.laddaAddTxn=!1,a.details.transactionId=c.transactionId,a.details.referenceNumber=c.referenceNumber,b.transitionTo("app.television.payment")},function(b){a.laddaAddTxn=!1,a.errors=e.transaction(b.data,b.status)}))},a.getProvider=function(){return a.details.billType===a.dstvProvider?"DSTV":"GOTV"},a.confirm=function(){if(a.pricing){a.laddaPay=!0;var b="GHS "+a.details.amountGhs+" on "+a.getProvider(),f=100*a.details.chargeUsd;d.makePayment(b,f).then(function(b){var f={stripeToken:b.id,transactionId:a.details.transactionId,type:a.transactionType};a.paymentToken=b,c.savePayment(f).then(function(){a.paymentSaveSuccess=!0,a.laddaPay=!1,d.successModal(a.details.referenceNumber,a.details.transactionId,a.transactionType)},function(b){a.paymentSaveSuccess=!1,a.laddaPay=!1,a.errors=e.payment(b.data,b.status)})},function(){a.laddaPay=!1})}}}]),angular.module("app.airtime",[]).config(["$stateProvider",function(a){var b="apps/airtime/views/";a.state("app.airtime",{url:"^/airtime",templateUrl:b+"layouts/airtime.html"}).state("app.airtime.choose",{url:"/choose",templateUrl:b+"choose.html",data:{pageTitle:"Choose Service"}}).state("app.airtime.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}}).state("app.airtime.payment",{url:"/payment",templateUrl:b+"payment.html",data:{pageTitle:"Confirm Payment"}})}]),angular.module("app.airtime").controller("AirtimeCtrl",["$scope","$state","Transaction","TransactionUtil","Error",function(a,b,c,d,e){"app.airtime.choose"!==b.current.name&&b.transitionTo("app.airtime.choose");var f=function(){return a.errors={},a.details.network!==a.airtelProvider&&a.details.network!==a.mtnProvider&&a.details.network!==a.tigoProvider&&a.details.network!==a.vodafoneProvider?(a.errors.network="Please select an airtime provider",!1):!0};a.details={recipient:{},amountGhs:"5"},a.details.serviceFee=0,a.chooseState=!0,a.errors=[],a.paymentSaveSuccess=!0,a.transactionType="AIRTIME",a.mtnProvider="MTN",a.airtelProvider="AIR",a.tigoProvider="TIG",a.vodafoneProvider="VOD",c.getProfile().then(function(b){b.profile.informationComplete?a.email=b.email:e.incompleteModal()},function(){}),c.getPricing().then(function(b){a.pricing=b,a.calculatePricing()},function(b){a.errors=e.pricing(b.data,b.status)}),c.getReferral().then(function(b){a.referral=b},function(){}),a.calculatePricing=function(){var b=d.calculateAirtimePricing(a.details.amountGhs,a.pricing);a.details.amountUsd=b.amountUsd,a.details.serviceFee=b.serviceFee,a.details.chargeUsd=b.chargeUsd},a.setDetails=function(){f()&&(a.recipientState=!0,b.transitionTo("app.airtime.recipient"))},a.addRecipient=function(){a.errors={},a.errors=d.validateRecipient(a.details),$.isEmptyObject(a.errors)&&(a.laddaAddTxn=!0,a.paymentState=!0,a.details.phoneNumber=a.details.recipient.phoneNumber,a.details.recipient.email||delete a.details.recipient.email,c.addAirtime(a.details).then(function(c){a.laddaAddTxn=!1,a.details.transactionId=c.transactionId,a.details.referenceNumber=c.referenceNumber,b.transitionTo("app.airtime.payment")},function(b){a.laddaAddTxn=!1,a.errors=e.transaction(b.data,b.status)}))},a.getProvider=function(){return a.details.network===a.mtnProvider?"MTN":a.details.network===a.tigoProvider?"TIGO":a.details.network===a.airtelProvider?"AIRTEL":"VODAFONE"},a.confirm=function(){if(a.pricing){a.laddaPay=!0;var b="GHS "+a.details.amountGhs+" worth of "+a.getProvider()+" airtime",f=100*a.details.chargeUsd;d.makePayment(b,f).then(function(b){var f={stripeToken:b.id,transactionId:a.details.transactionId,type:a.transactionType};a.paymentToken=b,c.savePayment(f).then(function(){a.paymentSaveSuccess=!0,a.laddaPay=!1,d.successModal(a.details.referenceNumber,a.details.transactionId,a.transactionType)},function(b){a.paymentSaveSuccess=!1,a.laddaPay=!1,a.errors=e.payment(b.data,b.status)})},function(){a.laddaPay=!1,console.log("Error")})}}}]),angular.module("app.utility",[]).config(["$stateProvider",function(a){var b="apps/utility/views/";a.state("app.utility",{url:"^/utility",templateUrl:b+"layouts/utility.html"}).state("app.utility.choose",{url:"/choose",templateUrl:b+"choose.html",data:{pageTitle:"Choose Service"}}).state("app.utility.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}}).state("app.utility.payment",{url:"/payment",templateUrl:b+"payment.html",data:{pageTitle:"Confirm Payment"}})}]),angular.module("app.utility").controller("UtilityCtrl",["$scope","$state","Transaction","TransactionUtil","Error",function(a,b,c,d,e){"app.utility.choose"!==b.current.name&&b.transitionTo("app.utility.choose");var f=function(){return a.errors={},a.details.billType!==a.electricityProvider&&a.details.billType!==a.waterProvider?(a.errors.billType="Please select a Utility service provider",!1):a.details.accountNumber&&a.details.accountNumber.toString().length<13?(a.errors.accountNumber="Please enter a 13-digit account number",!1):a.details.amountGhs?!0:(a.errors.amountGhs="Please enter the amount to pay in Ghana Cedis",!1)};a.details={recipient:{}},a.details.serviceFee=0,a.chooseState=!0,a.errors=[],a.paymentSaveSuccess=!0,a.transactionType="BILL",a.electricityProvider="ECG",a.waterProvider="GWC",c.getProfile().then(function(b){b.profile.informationComplete?a.email=b.email:e.incompleteModal()},function(){}),c.getPricing().then(function(b){a.pricing=b},function(b){a.errors=e.pricing(b.data,b.status)}),c.getReferral().then(function(b){a.referral=b},function(){}),a.reSavePayment=function(){if(!a.paymentSaveSuccess){var b={stripeToken:a.paymentToken.id,transactionId:a.details.transactionId,type:a.transactionType};c.savePayment(b).then(function(){a.paymentSaveSuccess=!0,d.successModal(a.details.referenceNumber,a.details.transactionId,a.transactionType)},function(b){a.paymentSaveSuccess=!1,a.errors=e.payment(b.data,b.status)})}},a.calculatePricing=function(){var b=d.calculateBillPricing(a.details.amountGhs,a.pricing);a.details.amountUsd=b.amountUsd,a.details.serviceFee=b.serviceFee,a.details.chargeUsd=b.chargeUsd},a.setDetails=function(){f()&&(a.recipientState=!0,b.transitionTo("app.utility.recipient"))},a.addRecipient=function(){a.errors=d.validateRecipient(a.details),$.isEmptyObject(a.errors)&&(a.paymentState=!0,a.details.accountNumber||delete a.details.accountNumber,a.details.recipient.email||delete a.details.recipient.email,a.laddaAddTxn=!0,c.addBill(a.details).then(function(c){a.laddaAddTxn=!1,a.details.transactionId=c.transactionId,a.details.referenceNumber=c.referenceNumber,b.transitionTo("app.utility.payment")},function(b){a.laddaAddTxn=!1,a.errors=e.transaction(b.data,b.status)}))},a.getProvider=function(){return a.details.billType===a.electricityProvider?"Electricity":"Water"},a.confirm=function(){if(a.pricing){a.laddaPay=!0;var b="GHS "+a.details.amountGhs+" on "+a.getProvider(),f=100*a.details.chargeUsd;d.makePayment(b,f).then(function(b){var f={stripeToken:b.id,transactionId:a.details.transactionId,type:a.transactionType};a.paymentToken=b,c.savePayment(f).then(function(){a.paymentSaveSuccess=!0,a.laddaPay=!1,d.successModal(a.details.referenceNumber,a.details.transactionId,a.transactionType)},function(b){a.paymentSaveSuccess=!1,a.laddaPay=!1,a.errors=e.payment(b.data,b.status)})},function(){a.laddaPay=!1})}}}]),angular.module("app.internet",[]).config(["$stateProvider",function(a){var b="apps/internet/views/";a.state("app.internet",{url:"^/internet",templateUrl:b+"layouts/internet.html"}).state("app.internet.choose",{url:"/choose",templateUrl:b+"choose.html",data:{pageTitle:"Choose Service"}}).state("app.internet.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}}).state("app.internet.payment",{url:"/payment",templateUrl:b+"payment.html",data:{pageTitle:"Confirm Payment"}})}]),angular.module("app.internet").controller("InternetCtrl",["$scope","$state","Transaction","TransactionUtil","Error",function(a,b,c,d,e){"app.internet.choose"!==b.current.name&&b.transitionTo("app.internet.choose");var f=function(){return a.errors={},a.details.billType!==a.surflineProvider&&a.details.billType!==a.vodafoneProvider?(a.errors.billType="Please select an Internet service provider",!1):!0};a.details={recipient:{},amountGhs:"125"},a.details.serviceFee=0,a.chooseState=!0,a.errors=[],a.paymentSaveSuccess=!0,a.transactionType="BILL",a.vodafoneProvider="VOB",a.surflineProvider="SRF",c.getProfile().then(function(b){b.profile.informationComplete?a.email=b.email:e.incompleteModal()},function(){}),c.getPricing().then(function(b){a.pricing=b,a.calculatePricing()},function(b){a.errors=e.pricing(b.data,b.status)}),c.getReferral().then(function(b){a.referral=b},function(){}),a.calculatePricing=function(){var b=d.calculateBillPricing(a.details.amountGhs,a.pricing);a.details.amountUsd=b.amountUsd,a.details.serviceFee=b.serviceFee,a.details.chargeUsd=b.chargeUsd},a.changeBillType=function(){a.details.billType===a.vodafoneProvider?a.details.amountGhs="70":a.details.amountGhs="125"},a.setDetails=function(){f()&&(a.recipientState=!0,b.transitionTo("app.internet.recipient"))},a.addRecipient=function(){a.errors=d.validateRecipient(a.details),$.isEmptyObject(a.errors)&&(a.paymentState=!0,a.details.accountNumber||delete a.details.accountNumber,a.details.recipient.email||delete a.details.recipient.email,a.laddaAddTxn=!0,c.addBill(a.details).then(function(c){a.laddaAddTxn=!1,a.details.transactionId=c.transactionId,a.details.referenceNumber=c.referenceNumber,b.transitionTo("app.internet.payment")},function(b){a.laddaAddTxn=!1,a.errors=e.transaction(b.data,b.status)}))},a.getProvider=function(){return a.details.billType===a.surflineProvider?"Surfline":"Vodafone"},a.confirm=function(){if(a.pricing){a.laddaPay=!0;var b="GHS "+a.details.amountGhs+" on "+a.getProvider(),f=100*a.details.chargeUsd;d.makePayment(b,f).then(function(b){var f={stripeToken:b.id,transactionId:a.details.transactionId,type:a.transactionType};a.paymentToken=b,c.savePayment(f).then(function(){a.paymentSaveSuccess=!0,a.laddaPay=!1,d.successModal(a.details.referenceNumber,a.details.transactionId,a.transactionType)},function(b){a.paymentSaveSuccess=!1,a.laddaPay=!1,a.errors=e.payment(b.data,b.status)})},function(){a.laddaPay=!1})}}}]),angular.module("app.school",[]).config(["$stateProvider",function(a){var b="apps/school/views/";a.state("app.school",{url:"^/school",templateUrl:b+"layouts/school.html"}).state("app.school.details",{url:"/details",templateUrl:b+"details.html",data:{pageTitle:"Choose Service"}}).state("app.school.contact",{url:"/contact",templateUrl:b+"contact.html",data:{pageTitle:"contact Details"}}).state("app.school.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Confirm Request"}})}]),angular.module("app.school").controller("SchoolCtrl",["$scope","$state","Transaction","TransactionUtil","Error","SettingsUtil",function(a,b,c,d,e,f){"app.school.details"!==b.current.name&&b.transitionTo("app.school.details");var g=function(){return a.errors={},a.details.wardName.firstName&&a.details.wardName.lastName?a.details.school?!0:(a.errors.school="Please enter the name of your ward's Intsitution",!1):(a.errors.name="Please provide both the first and last name of your ward",!1)},h=function(){if(a.errors={},!a.details.preferredContactDetails){switch(a.details.preferredContactMethod){case a.whatsAppMethod:a.errors.preferredContactMethod="Please enter your WhatsApp number in the contact details field.";break;case a.phoneMethod:a.errors.preferredContactMethod="Please enter your phone number in the contact details field.";break;case a.smsMethod:a.errors.preferredContactMethod="Please enter your SMS number in the contact details field.";break;case a.emailMethod:a.errors.preferredContactMethod="Please enter your email in the contact details field."}return!1}return!0};a.whatsAppMethod="WAP",a.smsMethod="SMS",a.phoneMethod="PHON",a.emailMethod="MAIL",a.details={wardName:{},recipient:{},preferredContactMethod:a.whatsAppMethod,preferredContactDetails:""},a.details.serviceFee=0,a.detailsState=!0,a.errors=[],a.paymentSaveSuccess=!0,a.transactionType="SCHOOL",c.getProfile().then(function(b){a.details.preferredContactMethod=b.profile.preferredContactMethod,a.details.preferredContactDetails=b.profile.preferredContactDetails,b.profile.informationComplete||e.incompleteModal()},function(){}),a.setDetails=function(){g()&&(a.contactState=!0,b.transitionTo("app.school.contact"))},a.setMethod=function(){h()&&(a.recipientState=!0,b.transitionTo("app.school.recipient"))},a.makeTransaction=function(){a.details.wardName.middleName?a.details.wardName=a.details.wardName.firstName+" "+a.details.wardName.middleName+" "+a.details.wardName.lastName:a.details.wardName=a.details.wardName.firstName+" "+a.details.wardName.lastName,a.details.amountGhs||delete a.details.amountGhs,a.details.recipient.email||delete a.details.recipient.email,a.errors=d.validateRecipient(a.details),$.isEmptyObject(a.errors)&&(a.laddaAddTxn=!0,c.addSchool(a.details).then(function(b){a.laddaAddTxn=!1,a.details.transactionId=b.transactionId,a.details.referenceNumber=b.referenceNumber,d.successModal(a.details.referenceNumber,a.details.transactionId,a.transactionType)},function(b){a.laddaAddTxn=!1,a.errors=e.transaction(b.data,b.status)}))},a.$watch("details.preferredContactMethod",function(a){f.changePrefContactDetails(a)})}]),angular.module("app.valet",[]).config(["$stateProvider",function(a){var b="apps/valet/views/";a.state("app.valet",{url:"^/valet",templateUrl:b+"layouts/valet.html"}).state("app.valet.details",{url:"/details",templateUrl:b+"details.html",data:{pageTitle:"Valet Details"}}).state("app.valet.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}})}]),angular.module("app.valet").controller("ValetCtrl",["$scope","$state","Transaction","TransactionUtil","Error","SettingsUtil",function(a,b,c,d,e,f){"app.valet.details"!==b.current.name&&b.transitionTo("app.valet.details");var g=function(){if(a.errors={},!a.details.description)return a.errors.description="Please enter a description",!1;if(!a.details.preferredContactDetails){switch(a.details.preferredContactMethod){case a.whatsAppMethod:a.errors.preferredContactMethod="Please enter your WhatsApp number in the contact details field.";break;case a.phoneMethod:a.errors.preferredContactMethod="Please enter your phone number in the contact details field.";break;case a.smsMethod:a.errors.preferredContactMethod="Please enter your SMS number in the contact details field.";break;case a.emailMethod:a.errors.preferredContactMethod="Please enter your email in the contact details field."}return!1}return!0};a.whatsAppMethod="WAP",a.smsMethod="SMS",a.phoneMethod="PHON",a.emailMethod="MAIL",a.details={recipient:{},preferredContactMethod:a.whatsAppMethod,preferredContactDetails:""},a.details.serviceFee=0,a.detailsState=!0,a.errors=[],a.paymentSaveSuccess=!0,a.transactionType="VALET",c.getProfile().then(function(b){a.details.preferredContactMethod=b.profile.preferredContactMethod,a.details.preferredContactDetails=b.profile.preferredContactDetails,b.profile.informationComplete||e.incompleteModal()},function(){}),a.setDetails=function(){g()&&(a.recipientState=!0,b.transitionTo("app.valet.recipient"))},a.makeTransaction=function(){a.errors=d.validateRecipient(a.details),$.isEmptyObject(a.errors)&&(a.laddaAddTxn=!0,c.addValet(a.details).then(function(b){a.laddaAddTxn=!1,a.details.transactionId=b.transactionId,a.details.referenceNumber=b.referenceNumber,d.successModal(a.details.referenceNumber,a.details.transactionId,a.transactionType)},function(b){a.laddaAddTxn=!1,a.errors=e.transaction(b.data,b.status)}))},a.$watch("details.preferredContactMethod",function(a){f.changePrefContactDetails(a)})}]),angular.module("app.gift",[]).config(["$stateProvider",function(a){var b="apps/gift/views/";a.state("app.gift",{url:"^/gift",templateUrl:b+"layouts/gift.html"}).state("app.gift.details",{url:"/details",templateUrl:b+"details.html",data:{pageTitle:"Gift Details"}}).state("app.gift.recipient",{url:"/recipient",templateUrl:b+"recipient.html",data:{pageTitle:"Recipient Details"}})}]),angular.module("app.gift").controller("GiftCtrl",["$scope","$state","Transaction","TransactionUtil","Error","SettingsUtil",function(a,b,c,d,e,f){"app.gift.details"!==b.current.name&&b.transitionTo("app.gift.details");var g=function(){if(a.errors={},!a.details.giftType)return a.errors.giftType="Please select your gift type.",!1;if("MISC"===a.details.giftType&&!a.details.additionalInfo)return a.errors.additionalInfo="Please enter the type of gift you would want us to send.",!1;if(!a.details.preferredContactDetails){switch(a.details.preferredContactMethod){case a.whatsAppMethod:a.errors.preferredContactMethod="Please enter your WhatsApp number in the contact details field.";break;case a.phoneMethod:a.errors.preferredContactMethod="Please enter your phone number in the contact details field.";break;case a.smsMethod:a.errors.preferredContactMethod="Please enter your SMS number in the contact details field.";break;case a.emailMethod:a.errors.preferredContactMethod="Please enter your email in the contact details field."}return!1}return!0};a.whatsAppMethod="WAP",a.smsMethod="SMS",a.phoneMethod="PHON",a.emailMethod="MAIL",a.details={recipient:{},preferredContactMethod:a.whatsAppMethod,preferredContactDetails:""},a.details.serviceFee=0,a.detailsState=!0,a.errors=[],a.paymentSaveSuccess=!0,a.transactionType="GIFT",c.getProfile().then(function(b){a.details.preferredContactMethod=b.profile.preferredContactMethod,a.details.preferredContactDetails=b.profile.preferredContactDetails,b.profile.informationComplete||e.incompleteModal()},function(){}),a.setDetails=function(){g()&&(a.recipientState=!0,b.transitionTo("app.gift.recipient"))},a.beforeRender=function(a,b){for(var c=new Date,d=0;d<b.length;d++)b[d].localDateValue()<c&&(b[d].selectable=!1)},a.makeTransaction=function(){a.details.deliveryAddress||delete a.details.deliveryAddress,a.details.deliveryTime||delete a.details.deliveryTime,a.details.recipient.email||delete a.details.recipient.email,a.errors=d.validateRecipient(a.details),$.isEmptyObject(a.errors)&&(a.laddaAddTxn=!0,c.addGift(a.details).then(function(b){a.laddaAddTxn=!1,a.details.transactionId=b.transactionId,a.details.referenceNumber=b.referenceNumber,d.successModal(a.details.referenceNumber,a.details.transactionId,a.transactionType)},function(b){a.laddaAddTxn=!1,a.errors=e.transaction(b.data,b.status)}))},a.$watch("details.preferredContactMethod",function(a){f.changePrefContactDetails(a)})}]);